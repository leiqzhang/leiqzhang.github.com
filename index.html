<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="kZ3lZdC9wn" />
  
  <title>Technology &amp; Life</title>
  <meta name="author" content="leiqzhang">
  
  <meta name="description" content="Virtualization Related Technologies">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Technology &amp; Life"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon" type="image/x-ico">
  <link rel="alternate" href="/atom.xml" title="Technology &amp; Life" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40319520-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F6f62dffd0688838f0bc52fc65fd62af4' type='text/javascript'%3E%3C/script%3E"));
</script>

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Technology &amp; Life</a></h1>
  <h2><a href="/">blog of leiqzhang</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-02-09T15:40:31.000Z"><a href="/2014/02/2014-02-09-nova-structure-data-workflow/">Feb 9 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/02/2014-02-09-nova-structure-data-workflow/">NOVA structure data workflow</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="NOVA-4ee3-7801-603b-4f53-7ed3-6784-548c-6570-636e-6d41-5411-603b-7ed3-">NOVA代码总体结构和数据流向总结</h1>
<p><strong>前提</strong></p>
<ol>
<li>对Nova的整体结构已经有所理解</li>
<li>基于stable/havana分支</li>
<li>基于Redhat的RDO库进行的环境安装，基于CentOS 6.4</li>
<li>主机名为controller</li>
</ol>
<p><strong>内容</strong></p>
<ol>
<li>Nova代码总体组织结构</li>
<li>Nova对外提供的服务中，一般的执行路径</li>
</ol>
<p><strong>目的</strong></p>
<ol>
<li>为后续新增代码时，提供所需遵循的代码层次结构提供参考</li>
</ol>
<p><strong>注意</strong></p>
<p>尚不完整，需要进一步补充和完善</p>
<h2 id="Nova-4ee3-7801-603b-4f53-7ed3-6784-">Nova代码总体结构</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="code"><pre><span class="comment">├──</span> <span class="comment">etc</span>
<span class="comment">│</span>   <span class="comment">└──</span> <span class="comment">nova</span> <span class="literal">-</span> <span class="comment">相关配置文件</span>
<span class="comment">├──</span> <span class="comment">nova</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">api</span> <span class="literal">-</span> <span class="comment">Nova</span> <span class="comment">对外的</span> <span class="comment">REST</span> <span class="comment">API</span>
<span class="comment">│</span>   <span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">ec2</span> <span class="literal">-</span> <span class="comment">the</span> <span class="comment">Amazon</span> <span class="comment">EC2</span> <span class="comment">API</span> <span class="comment">bindings</span>
<span class="comment">│</span>   <span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">metadata</span> <span class="literal">-</span> <span class="comment">Nova</span> <span class="comment">metadata</span> <span class="comment">Server</span> <span class="comment">API</span> 
<span class="comment">│</span>   <span class="comment">│</span>   <span class="comment">└──</span> <span class="comment">openstack</span> <span class="literal">-</span> <span class="comment">the</span> <span class="comment">OpenStack</span> <span class="comment">API</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">cell</span> <span class="literal">-</span> <span class="comment">Nova</span> <span class="comment">Cell形似部署时的</span> <span class="comment">Cell</span> <span class="comment">Service</span> <span class="comment">Component</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">cert</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">cloudpipe</span> <span class="literal">-</span> <span class="comment">VPN</span> <span class="comment">Server</span> <span class="comment">Management</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">cmd</span> <span class="literal">-</span> <span class="comment">Component的Service启动脚本</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">compute</span> <span class="literal">-</span> <span class="comment">Nova</span> <span class="comment">Compute</span> <span class="comment">Service</span> <span class="comment">Component</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">conductor</span> <span class="literal">-</span> <span class="comment">Nova</span> <span class="comment">Conductor</span> <span class="comment">Service</span> <span class="comment">Component</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">console</span> <span class="literal">-</span> <span class="comment">instance</span> <span class="comment">console</span> <span class="comment">library</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">consoleauth</span> <span class="literal">-</span> <span class="comment">Nova</span> <span class="comment">ConsoleAuth</span> <span class="comment">Service</span> <span class="comment">Component</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">db</span> <span class="literal">-</span> <span class="comment">database</span> <span class="comment">abstraction</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">hacking</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">image</span> <span class="literal">-</span> <span class="comment">the</span> <span class="comment">Image</span> <span class="comment">Service</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">ipv6</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">keymgr</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">locale</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">network</span> <span class="literal">-</span> <span class="comment">the</span> <span class="comment">Nova</span> <span class="comment">Network</span> <span class="comment">Service</span> <span class="comment">Component</span>
<span class="comment">│</span>   <span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">neutronv2</span> <span class="literal">-</span> <span class="comment">the</span> <span class="comment">Neutron</span> <span class="comment">API</span>
<span class="comment">│</span>   <span class="comment">│</span>   <span class="comment">└──</span> <span class="comment">security_group</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">objects</span> <span class="literal">-</span> <span class="comment">The</span> <span class="comment">Model</span> <span class="comment">Level</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">objectstore</span> <span class="literal">-</span> <span class="comment">基于本地文件实现的S3</span><span class="literal">-</span><span class="comment">like的Storage</span> <span class="comment">Server，主要用于测试</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">openstack</span> <span class="literal">-</span> <span class="comment">ongoing</span> <span class="comment">effort</span> <span class="comment">to</span> <span class="comment">reuse</span> <span class="comment">Nova</span> <span class="comment">parts</span> <span class="comment">with</span> <span class="comment">other</span> <span class="comment">OpenStack</span> <span class="comment">parts</span><span class="string">.</span>
<span class="comment">│</span>   <span class="comment">│</span>   <span class="comment">└──</span> <span class="comment">common</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">pci</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">scheduler</span> <span class="literal">-</span> <span class="comment">Nova</span> <span class="comment">Scheduler</span> <span class="comment">Service</span> <span class="comment">Component</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">servicegroup</span> <span class="literal">-</span> <span class="comment">Service</span> <span class="comment">Group</span> <span class="comment">Support</span>
<span class="comment">│</span>   <span class="comment">│</span>   <span class="comment">└──</span> <span class="comment">drivers</span>  <span class="literal">-</span> <span class="comment">Service</span> <span class="comment">Group</span> <span class="comment">Drivers:</span> <span class="comment">ZooKeeper，Database，Memcached</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">spice：</span> <span class="comment">Spice</span> <span class="comment">libraries</span> <span class="comment">for</span> <span class="comment">accessing</span> <span class="comment">instances</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">storage:</span> <span class="comment">Linux</span> <span class="comment">SCSI</span> <span class="comment">Related</span> <span class="comment">Misc</span> <span class="comment">Methods</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">tests</span> <span class="literal">-</span> <span class="comment">Unit</span> <span class="comment">tests</span><span class="string">.</span> <span class="comment">Sub</span> <span class="comment">directories</span> <span class="comment">should</span> <span class="comment">mirror</span> <span class="string">.</span><span class="comment">/nova</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">virt</span> <span class="literal">-</span> <span class="comment">Hypervisor</span> <span class="comment">abstractions</span>
<span class="comment">│</span>   <span class="comment">├──</span> <span class="comment">vnc</span> <span class="literal">-</span> <span class="comment">VNC</span> <span class="comment">libraries</span> <span class="comment">for</span> <span class="comment">accessing</span> <span class="comment">instances</span>
<span class="comment">│</span>   <span class="comment">└──</span> <span class="comment">volume</span> <span class="literal">-</span> <span class="comment">the</span> <span class="comment">Volume</span> <span class="comment">Service</span>
<span class="comment">├──</span> <span class="comment">plugins</span> <span class="literal">-</span> <span class="comment">hypervisor</span> <span class="comment">host</span> <span class="comment">plugins</span><span class="string">.</span> <span class="comment">Mostly</span> <span class="comment">for</span> <span class="comment">XenServer</span><span class="string">.</span>
</pre></td></tr></table></figure>

<p>就其中已经分析或了解到的部分进行下说明：</p>
<ul>
<li>Service Component：对应的就是一个个Nova服务，即nova-compute、nova-scheduler、nova-conductor，等等</li>
<li>cmd： 用于启动相应的Nova Service, 主要是利用Service.Create来封装相应的Service Component。例如cmd.api和cmd.scheduler分别是启动nova-api和nova-scheduler服务的。RDO的相应的服务启动脚本最终都是调用的这里</li>
<li>conductor： 引入的目的是为了避免compute直接对数据库的访问，并引入些跨计算节点的功能。从目前Havana代码来看，还有很多功能还是直接由compute来访问数据库的，比如关机等</li>
</ul>
<h2 id="Service_Component">Service Component</h2>
<p>每个Service Component基本都会包含由api、manager和rpcapi，api主要用于模块间的直接调用，rpcapi主要用于通过MQ进行远程的模块间调用，manager主要用于此模块的功能，具体执行时，又可能会有多个driver可选。</p>
<h2 id="Data_Workflow">Data Workflow</h2>
<p>一般来说，一个对外的计算相关特性的具体执行路径为：</p>
<ol>
<li>首先由nova.api.openstack.compute来处理REST API相关逻辑</li>
<li>调用Controller的计算服务，及nova.compute.api</li>
<li>涉及到远程调用其它Service Component的，则会调用相应Component的rpcapi，通过MQ发送消息，涉及到本地调用其它Service Component的，则会调用其的api</li>
<li>相应的Service Component的Manager会从MQ中接收到相应的消息或者被此Component的api调用，根据请求类型，使用相应的driver或者继续按3的过程和其它Component进行交互</li>
</ol>
<h2 id="-53c2-8003-8d44-6599-">参考资料</h2>
<ul>
<li><a href="http://www.sandywalsh.com/2012/04/openstack-nova-internals-pt1-overview.html" target="_blank">Nova Internals</a></li>
<li><a href="http://www.slideshare.net/lzyeval/hacking-on-openstacks-nova-source-code" target="_blank">Hacking on Openstack Nova Souce Code</a></li>
<li><a href="http://docs.openstack.org/developer/nova/devref/services.html" target="_blank">Service, Mananger 和 Driver</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-02-09T14:55:31.000Z"><a href="/2014/02/2014-02-09-nova-v3-api-extension-framework/">Feb 9 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/02/2014-02-09-nova-v3-api-extension-framework/">NOVA V3 API Extension Framework</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="NOVA_V3_API_Extension_Framework">NOVA V3 API Extension Framework</h1>
<p><strong>背景</strong></p>
<ol>
<li>基于stable/havana分支</li>
<li>基于CentOS 6.4，以Redhat的RDO库进行的环境安装</li>
</ol>
<p><strong>内容</strong></p>
<ol>
<li>V2扩展机制存在的问题</li>
<li>Nova API V3中Plugin的实现机制和现状</li>
<li>总结</li>
</ol>
<h2 id="V2-7684-6269-5c55-673a-5236-5b58-5728-7684-95ee-9898-">V2的扩展机制存在的问题</h2>
<p>参考V3 API framework的Spec，当前V2 API存在的问题如下：</p>
<p>The development of the Nova v3 API will give us the opportunity to rework the extension framework. The current framework suffers from:</p>
<ul>
<li>extension specific code required to exist in core code for specific extensions to work<ul>
<li>eg nova/api/openstack/compute/servers.py:Controller:create where there are hard coded references to parameters specific to extensions to pass kwargs to the server create call</li>
</ul>
</li>
<li>issues around efficiency with extensions each doing their own db lookup loops<ul>
<li><a href="https://bugs.launchpad.net/nova/+bug/1160487" target="_blank">https://bugs.launchpad.net/nova/+bug/1160487</a></li>
</ul>
</li>
<li>Can’t have CamelCase class names for extension classes due to extension loading mechanism</li>
</ul>
<p>这里主要展开说明前两点。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2014/02/2014-02-09-nova-v3-api-extension-framework/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-01-09T14:40:31.000Z"><a href="/2014/01/2014-01-09-nova-scheduler-service-initialization/">Jan 9 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/01/2014-01-09-nova-scheduler-service-initialization/">NOVA Scheduler Service Initialization Process</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="NOVA-SCHEDULER-670d-52a1-542f-52a8-6d41-7a0b-">NOVA-SCHEDULER服务启动流程</h1>
<p><strong>前提</strong></p>
<ol>
<li>对Nova的整体结构已经有所理解</li>
<li>基于stable/havana分支</li>
<li>基于Redhat的RDO库进行的环境安装，基于CentOS 6.4</li>
<li>主机名为controller</li>
</ol>
<p><strong>内容</strong></p>
<ol>
<li>openstack-nova-scheduler服务启动流程</li>
<li>MessageQueue的相关知识及在scheduler服务启动过程中的涉及的行为</li>
</ol>
<h2 id="-6267-884c-7ed3-679c-">执行结果</h2>
<p>根据之前对Noah系统结构的理解，在scheduler启动过程中，会和MessageQueue交互，创建相应的Exchange和Consumer。</p>
<p>启动前的MessageQueue的状态：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre><span class="comment">#rabbitmqctl list_exchanges name type durable internal</span>
Listing exchanges <span class="keyword">...</span>
	direct	true	false
amq.direct	direct	true	false
amq.fanout	fanout	true	false
amq.headers	headers	true	false
amq.match	headers	true	false
amq.rabbitmq.log	topic	true	false
amq.rabbitmq.trace	topic	true	false
amq.topic	topic	true	false
...done.

<span class="comment">#rabbitmqctl list_bindings source_name source_kind destination_name destination_kind routing_key</span>
Listing bindings <span class="keyword">...</span>
...done.

<span class="comment">#rabbitmqctl list_connections pid name  port host peer_port peer_host state channels protocol</span>
Listing connections <span class="keyword">...</span>
...done.

<span class="comment">#rabbitmqctl list_channels pid connection name number consumer_count</span>
Listing channels <span class="keyword">...</span>
...done.

<span class="comment">#rabbitmqctl list_consumers</span>
Listing consumers <span class="keyword">...</span>
...done.
</pre></td></tr></table></figure>

<p>由上可知，在Scheduler启动前，只有RabbitMQ-Server默认创建的一些exchange，而binding、connection、channel和consumer均为空。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2014/01/2014-01-09-nova-scheduler-service-initialization/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-01-09T14:40:31.000Z"><a href="/2014/01/2014-01-09-nova-api-service-initialization/">Jan 9 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/01/2014-01-09-nova-api-service-initialization/">NOVA API Service Initialization Process</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="NOVA-API-670d-52a1-542f-52a8-6d41-7a0b-">NOVA-API服务启动流程</h1>
<p><strong>前提</strong></p>
<ol>
<li>对Nova的整体结构已经有所理解</li>
<li>基于stable/havana分支</li>
<li>基于Redhat的RDO库进行的环境安装，基于CentOS 6.4</li>
</ol>
<p><strong>内容</strong></p>
<ol>
<li>openstack-nova-api服务启动流程</li>
<li>Paste、Deploy、WSGI等相关知识</li>
</ol>
<h2 id="-6267-884c-7ed3-679c-">执行结果</h2>
<p>启动API服务时的命令为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="comment">service</span> <span class="comment">openstack</span><span class="literal">-</span><span class="comment">nova</span><span class="literal">-</span><span class="comment">api</span> <span class="comment">start</span>
</pre></td></tr></table></figure>

<p>启动成功后，查看系统进程，发现实际执行结果为一个nova-api父进程，同时其有三个nova-api子进程：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>nova <span class="number">3438</span> S <span class="number">0</span>:<span class="number">07</span> <span class="subst">/</span>usr<span class="subst">/</span>bin<span class="subst">/</span>python <span class="subst">/</span>usr<span class="subst">/</span>bin<span class="subst">/</span>nova<span class="attribute">-api</span> <span class="subst">--</span>logfile <span class="subst">/</span><span class="built_in">var</span><span class="subst">/</span><span class="keyword">log</span><span class="subst">/</span>nova<span class="subst">/</span>api<span class="built_in">.</span><span class="keyword">log</span>
nova <span class="number">3446</span> S <span class="number">0</span>:<span class="number">00</span> <span class="subst">\</span>_ <span class="subst">/</span>usr<span class="subst">/</span>bin<span class="subst">/</span>python <span class="subst">/</span>usr<span class="subst">/</span>bin<span class="subst">/</span>nova<span class="attribute">-api</span> <span class="subst">--</span>logfile <span class="subst">/</span><span class="built_in">var</span><span class="subst">/</span><span class="keyword">log</span><span class="subst">/</span>nova<span class="subst">/</span>api<span class="built_in">.</span><span class="keyword">log</span>
nova <span class="number">3447</span> S <span class="number">0</span>:<span class="number">00</span> <span class="subst">\</span>_ <span class="subst">/</span>usr<span class="subst">/</span>bin<span class="subst">/</span>python <span class="subst">/</span>usr<span class="subst">/</span>bin<span class="subst">/</span>nova<span class="attribute">-api</span> <span class="subst">--</span>logfile <span class="subst">/</span><span class="built_in">var</span><span class="subst">/</span><span class="keyword">log</span><span class="subst">/</span>nova<span class="subst">/</span>api<span class="built_in">.</span><span class="keyword">log</span>
nova <span class="number">3448</span> S <span class="number">0</span>:<span class="number">00</span> <span class="subst">\</span>_ <span class="subst">/</span>usr<span class="subst">/</span>bin<span class="subst">/</span>python <span class="subst">/</span>usr<span class="subst">/</span>bin<span class="subst">/</span>nova<span class="attribute">-api</span> <span class="subst">--</span>logfile <span class="subst">/</span><span class="built_in">var</span><span class="subst">/</span><span class="keyword">log</span><span class="subst">/</span>nova<span class="subst">/</span>api<span class="built_in">.</span><span class="keyword">log</span>
</pre></td></tr></table></figure>

<p>查看监听的端口，发现父进程nova-api同时监听了三个端口：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="title">tcp</span>        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0.0.0:8773</span>                <span class="number">0.0.0.0</span>:*                   LISTEN      <span class="number">3438</span>/python         
tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0.0.0:8774</span>                <span class="number">0.0.0.0</span>:*                   LISTEN      <span class="number">3438</span>/python         
tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0.0.0:8775</span>                <span class="number">0.0.0.0</span>:*                   LISTEN      <span class="number">3438</span>/python
</pre></td></tr></table></figure>

<h2 id="-4ee3-7801-8def-5f84-">代码路径</h2>
<h3 id="-4e3b-8981-8def-5f84-">主要路径</h3>
<p>服务启动脚本为/etc/init.d/openstack-nova-api，查看此脚本发现在启动服务时实际执行的是/usr/bin/nova-api,而/usr/bin/nova-api是一个python脚本，实际执行的是nova.cmd.api.main</p>
<p>nova.cmd.api.main的主要代码如下：</p>
<figure class="highlight lang-python"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>    launcher = service.process_launcher()
    <span class="keyword">for</span> api <span class="keyword">in</span> CONF.enabled_apis:
        should_use_ssl = api <span class="keyword">in</span> CONF.enabled_ssl_apis
        <span class="keyword">if</span> api == <span class="string">'ec2'</span>:
            server = service.WSGIService(api, use_ssl=should_use_ssl,
                                         max_url_len=<span class="number">16384</span>)
        <span class="keyword">else</span>:
            server = service.WSGIService(api, use_ssl=should_use_ssl)
        launcher.launch_service(server, workers=server.workers <span class="keyword">or</span> <span class="number">1</span>)
    launcher.wait()
</pre></td></tr></table></figure>

<p>首先生成一个nova.common.service.Processlauncher类型的launcher, 接着会根据配置中的enabled_apis列表值，依次生成相应的WSGIService:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>server = service.WSGIService(<span class="keyword">...</span>)
</pre></td></tr></table></figure>

<p>然后通过launcher的launch_service方法，将上述的WSGIService和workers数量作为参数传入。</p>
<p>在luanch_service方法中，会根据传入的workers参数fork出相应个数的子进程，并在各个子进程中调用对应WSGIService的start方法，开始对外服务。</p>
<h3 id="-6d89-53ca-7684-914d-7f6e-">涉及的配置</h3>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2014/01/2014-01-09-nova-api-service-initialization/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-08-07T14:40:31.000Z"><a href="/2013/08/2013-08-07-virtual-disk-unmap-shrink/">Aug 7 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/08/2013-08-07-virtual-disk-unmap-shrink/">虚拟磁盘的空间回收: Virtual Disk UNMAP/Shrink</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="-95ee-9898-">问题</h2>
<p>在虚拟化场景下，瘦分配(Thin-provisioning)磁盘应用场景非常广泛。目前主流的虚拟磁盘镜像格式，如Dynamic VHD、Sparse Raw、Qcow2、VMDK等均只具有随着虚拟机读写而动态增长的能力，一般来说是按需每次分配一个固定大小的块，如VHD的块是2M为单位。</p>
<p>当Guest OS删除了文件，已经分配的空间在虚拟磁盘上可否进行空间回收呢？</p>
<p>空间回收主要包括两步，一是获取到可以回收的空间，二是在虚拟磁盘文件中对相应空间进行回收。</p>
<p>根据获取所需回收空间时虚拟磁盘的IO情况来讲，回收主要有在线回收和离线回收，在线和离线的区别在于虚拟磁盘是否在有Guest持续写IO的情况下进行空间回收。也即离线回收不单单指虚拟机关机情形下的回收，也包括虚拟磁盘只有读IO的情况（如虚拟磁盘为某个ROW快照的父镜像）。</p>
<p>就虚拟磁盘文件来说，空间回收的结果可以是如下两种</p>
<ol>
<li>在Host上实际占用的空间减少</li>
<li>在Host上实际占用的空间减少，但是后续Guest的写入可以复用之前需要回收的空间，从而使得虚拟磁盘文件不会随着Guest的写入立即分配新块</li>
</ol>
<p>下文首先分别对离线和在线可回收空间获取方法进行讨论，然后对虚拟磁盘文件的空间回收方式进行讨论，最后以Qemu当前的实现为例进行说明。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/08/2013-08-07-virtual-disk-unmap-shrink/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-06-27T14:40:31.000Z"><a href="/2013/06/2013-06-27-merge-linear-dm-disks-into-single-disk-as-partitions/">Jun 27 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/06/2013-06-27-merge-linear-dm-disks-into-single-disk-as-partitions/">将多个linear device mapper虚拟磁盘改造为同一磁盘的多个分区</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="-95ee-9898-">问题</h2>
<p>在虚拟化场景下，历史上存在如下虚拟磁盘的管理模式：</p>
<p>在一个LUN上通过linear device mapper的方式制作出若干个DM设备，这些DM设备之间在LUN上并不一定完全相邻，但第一个DM设备必然是从LUN的0扇区开始划分。将这些DM设备以RAW格式的虚拟镜像(卷)挂载给VM使用。</p>
<figure class="highlight"><figcaption><span>structure</span></figcaption><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>
               <span class="comment">╔════════════════╗</span>
               <span class="comment">║</span>      <span class="comment">VM</span>        <span class="comment">║</span>
               <span class="comment">╚═══════╬════════╝</span>
                       <span class="comment">|</span>
                       <span class="comment">|</span>
        <span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span>
        <span class="comment">|</span>                           <span class="comment">|</span>
 <span class="comment">╔══════╬═══════╤══════════╤════════╬═══════╗</span>
 <span class="comment">║</span>  <span class="comment">DM</span>          <span class="comment">│</span>   <span class="comment">GAP</span>    <span class="comment">│</span>   <span class="comment">DM</span>           <span class="comment">║</span>
 <span class="comment">╚══════════════╧══════════╧════════════════╝</span>
</pre></td></tr></table></figure>


<p>为了便于管理，现在需要将这些LUN按照一个单独卷进行管理。如果直接将此LUN挂载给VM,则只能识别到第一个DM设备对应的虚拟磁盘，后面的DM设别将不会被识别。</p>
<p>本文主要讨论如何在不损坏数据且高效的解决此问题，达到透明的管理模式切换，即将LUN挂载给VM后，VM还是可以识别到和之前一样数量的磁盘。</p>
<h2 id="-95ee-9898-539f-56e0-53ca-89e3-51b3-601d-8def-">问题原因及解决思路</h2>
<p>由于之前是通过DM方式划分的LUN，并将不同的DM设备分别进行的文件系统格式化，故在每个DM设备起始位置的MBR或GPT中只会包含有此DM设备相关的分区信息。</p>
<p>当把LUN整体挂载给VM时，VM只能通过此LUN起始位置处的MBR或GPT信息来识别磁盘分区信息，由于LUN起始位置的MBR就是第一个DM设备的MBR，故只能识别到第一个DM设备。</p>
<p>解决此问题的思路也很简单，即将此LUN上除第一个DM外的DM设备的分区信息添加到第一个DM的MBR/GPT中包含的分区表中即可。</p>
<h2 id="-573a-666f-6784-9020-">场景构造</h2>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/06/2013-06-27-merge-linear-dm-disks-into-single-disk-as-partitions/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-06-18T12:40:31.000Z"><a href="/2013/06/2013-06-19-ovirt-node-isolinux-white-block-after-bootloader/">Jun 18 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/06/2013-06-19-ovirt-node-isolinux-white-block-after-bootloader/">White background after boot menu of isolinux in ovirt-node</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="-95ee-9898-">问题</h2>
<p>当通过llivecd启动系统进行第一次部署时，在BOOT MENU页面(isolinux)后，会首先出现一段时间的“白屏”现象，然后才可以进入到安装和配置界面</p>
<h2 id="-95ee-9898-539f-56e0-">问题原因</h2>
<p>确认是启动参数中缺少了vga=选项</p>
<p>可参考： <a href="https://wiki.archlinux.org/index.php/Syslinux#White_block_in_upper_left_corner_when_using_vesamenu" target="_blank">https://wiki.archlinux.org/index.php/Syslinux#White_block_in_upper_left_corner_when_using_vesamenu</a></p>
<blockquote><p>Problem: As of linux-3.0, the modesetting driver tries to keep the current contents of the screen after changing the resolution (at least it does so with my Intel, when having Syslinux in text mode). It seems that this goes wrong when combined with the vesamenu module in Syslinux (the white block is actually an attempt to keep the Syslinux menu, but the driver fails to capture the picture from vesa graphics mode).</p>
<p>If you have a custom resolution and a vesamenu with early modesetting, try to append the following in syslinux.cfg to remove the white block and continue in graphics mode:</p>
<p>APPEND root=/dev/sda6 ro 5 vga=current quiet splash</p>
<footer><strong>archlinux_wiki,White_block_in_upper_left_corner_when_using_vesamenu</strong><cite><a href="https://wiki.archlinux.org/index.php/Syslinux#White_block_in_upper_left_corner_when_using_vesamenu" target="_blank">ref_detail</a></cite></footer></blockquote>



<h2 id="-793e-533a-76f8-5173-BUG-53ca-63cf-8ff0-">社区相关BUG及描述</h2>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/06/2013-06-19-ovirt-node-isolinux-white-block-after-bootloader/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-06-18T12:40:31.000Z"><a href="/2013/06/2013-06-18-virtualization-performance-considerations/">Jun 18 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/06/2013-06-18-virtualization-performance-considerations/">Virtualization performance considerations</a></h1>
  

    </header>
    <div class="entry">
      
        <p>今天看了云计算大会2013上EMC/Vmware的一片关于虚拟化性能的文章，结合之前看过的一些材料对其进行了汇总和总结。主要站在全云计算堆栈的整体视角上看各个组件或特性对性能的影响。</p>
<p>需要注意的是性能会包括好多指标，这些指标往往是互相矛盾的，如实时性（低延迟）和CPU利用率、电源利用率等等。本文也会结合之前vmware的文档归纳下如何尽可能地提高虚拟化场景下的实时性。</p>
<h2 id="CPU_-26-amp-3b-_Memory">CPU &amp; Memory</h2>
<ol>
<li><p>NUMA</p>
<p> <strong>Respect boundaries, rightsize, use like topologies.</strong></p>
<p> Hypervisor的调度器需要尽可能将同一个VM的所有vCPU调度到同一个NUMA节点上，同时此VM相关的内存需要分配到此节点的本地物理内存中。</p>
<p> Vmware ESX 5.0及之后的版本支持一种叫做<strong>vNUMA</strong>的特性，它将Host的NUMA特征暴露给了Guest OS，从而使得Guest OS可以根据NUMA特征进行更高性能的调度。</p>
</li>
<li><p>CPU相关的一些指标和新特性</p>
<ul>
<li>Processor Clock Frequency</li>
<li>Dual or Quad Socket</li>
<li>Hyper-threading (=Enabled)</li>
<li>Support <strong>EPT</strong>(Intel) or <strong>RVI</strong>(AMD), eg. Hwmmu</li>
</ul>
</li>
<li><p>BIOS相关</p>
<p> 主要是指BIOS中对电源管理方式的设置。<br> 
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/06/2013-06-18-virtualization-performance-considerations/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-06-17T12:40:31.000Z"><a href="/2013/06/2013-06-17-ovirt-node-realted-infos/">Jun 17 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/06/2013-06-17-ovirt-node-realted-infos/">Ovirt Node Related Infomation</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="-7b80-4ecb-">简介</h2>
<p>ovirt-node 是开源虚拟化管理平台 oVirt 的客户端部分，它是一个经过定制的最小化 fedora 系统，充当虚拟机管理器（Hypervisor）host 的角色，与管理端 overt-engine 组成一个虚拟化管理平台。ovirt-node 以其小巧，灵活的特点，可以很方便地进行开发与定制。</p>
<p>ovirt-node提供的镜像中包含libvirt/vdsm（Virtual Desktop Server Manager)、KVM等虚拟化服务，使用libvirt/vdsm管理KVM虚拟机。</p>
<p>ovirt-node提供的镜像所需资源很小，可以将更多的资源保留给VM使用。</p>
<p>综合来说，ovirt-node的特点包括：</p>
<ul>
<li>Dedicated hypervisor</li>
<li>JEOS</li>
<li>livecd</li>
<li>Built on Fedora</li>
<li>Firmware</li>
<li>Small Footprint (&lt;200MB)</li>
</ul>
<h2 id="-4f18-7f3a-70b9-">优缺点</h2>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/06/2013-06-17-ovirt-node-realted-infos/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-06-13T12:40:31.000Z"><a href="/2013/06/2013-06-13-webpy-cors-problem/">Jun 13 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/06/2013-06-13-webpy-cors-problem/">HTTP access control (CORS) of Web.py</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="-95ee-9898-63cf-8ff0-">问题描述</h2>
<p>由于想使用gevent，当前请求结构为browser-&gt;lighttpd(portal)-&gt;web.py，其中lighttpd和web.py运行在同一台服务器上并监听不同的端口。portal上一些请求会直接发送给web.py，即web.py直接用作了REST的Gateway。</p>
<p>但当使用FF/Chrome在通过和web.py不同的domain向其发起POST请求返回一个JSON数据后，web.py收到的请求Method为<strong>OPTIONS</strong>而非<strong>POST</strong>，由于OPTIONS非web.py支持的Method,故会返回405，Method Not Found. Chrome/FF的Console中会有如下形式的错误：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>
XMLHttpRequest Cannot load <span class="attribute">http</span>:<span class="regexp">//</span><span class="attribute">server</span>:webpy_port/path. Origin <span class="keyword">is</span> <span class="keyword">not</span> allowed <span class="keyword">by</span> Access-Control-Allow-Origin
</pre></td></tr></table></figure>



      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/06/2013-06-13-webpy-cors-problem/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:leiqzhang.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/Linux/">Linux</a><small>3</small></li>
  
    <li><a href="/categories/OpenStack/">OpenStack</a><small>4</small></li>
  
    <li><a href="/categories/VIM/">VIM</a><small>3</small></li>
  
    <li><a href="/categories/Virtualization/">Virtualization</a><small>16</small></li>
  
    <li><a href="/categories/WordPress/">WordPress</a><small>2</small></li>
  
    <li><a href="/categories/miscellaneous/">miscellaneous</a><small>1</small></li>
  
    <li><a href="/categories/web_dev/">web_dev</a><small>8</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">Tag Cloud</h3>
  <div class="entry">
    <a href="/tags/CIM/" style="font-size: 10.00px;">CIM</a><a href="/tags/CORS/" style="font-size: 10.00px;">CORS</a><a href="/tags/DBPM/" style="font-size: 10.00px;">DBPM</a><a href="/tags/Deploy/" style="font-size: 10.00px;">Deploy</a><a href="/tags/ELI/" style="font-size: 10.00px;">ELI</a><a href="/tags/NUMA/" style="font-size: 10.00px;">NUMA</a><a href="/tags/Nova/" style="font-size: 16.00px;">Nova</a><a href="/tags/OPTIONS/" style="font-size: 10.00px;">OPTIONS</a><a href="/tags/Paste/" style="font-size: 10.00px;">Paste</a><a href="/tags/QEMU/" style="font-size: 20.00px;">QEMU</a><a href="/tags/RabbitMQ/" style="font-size: 10.00px;">RabbitMQ</a><a href="/tags/Stevedore/" style="font-size: 10.00px;">Stevedore</a><a href="/tags/WSGI/" style="font-size: 10.00px;">WSGI</a><a href="/tags/bfc/" style="font-size: 10.00px;">bfc</a><a href="/tags/block-stream/" style="font-size: 10.00px;">block-stream</a><a href="/tags/blockcopy/" style="font-size: 12.00px;">blockcopy</a><a href="/tags/cache/" style="font-size: 10.00px;">cache</a><a href="/tags/css/" style="font-size: 12.00px;">css</a><a href="/tags/dataplane/" style="font-size: 10.00px;">dataplane</a><a href="/tags/device-mapper/" style="font-size: 10.00px;">device-mapper</a><a href="/tags/ervernote/" style="font-size: 10.00px;">ervernote</a><a href="/tags/etag/" style="font-size: 10.00px;">etag</a><a href="/tags/eval/" style="font-size: 10.00px;">eval</a><a href="/tags/fdisk/" style="font-size: 10.00px;">fdisk</a><a href="/tags/fedora/" style="font-size: 10.00px;">fedora</a><a href="/tags/gpt/" style="font-size: 10.00px;">gpt</a><a href="/tags/greasemonkey/" style="font-size: 10.00px;">greasemonkey</a><a href="/tags/http/" style="font-size: 12.00px;">http</a><a href="/tags/isolinux/" style="font-size: 10.00px;">isolinux</a><a href="/tags/javascript/" style="font-size: 10.00px;">javascript</a><a href="/tags/libvirt/" style="font-size: 18.00px;">libvirt</a><a href="/tags/lighthttpd/" style="font-size: 10.00px;">lighthttpd</a><a href="/tags/lighttpd/" style="font-size: 10.00px;">lighttpd</a><a href="/tags/livecd/" style="font-size: 10.00px;">livecd</a><a href="/tags/mac/" style="font-size: 10.00px;">mac</a><a href="/tags/mbr/" style="font-size: 10.00px;">mbr</a><a href="/tags/md5sum/" style="font-size: 10.00px;">md5sum</a><a href="/tags/mysql/" style="font-size: 12.00px;">mysql</a><a href="/tags/oVirt/" style="font-size: 14.00px;">oVirt</a><a href="/tags/parted/" style="font-size: 10.00px;">parted</a>
  </div>
</div>


  <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=0&uid=1644437791&verifier=c45a1931&dpc=1"></iframe>


  <div class="widget tag">
<h3 class="title">友情链接</h3>
<ul class="entry">
<li><a href="http://blog.csdn.net/luo_brian" title="luo_brian">Luohao</a></li>
<li><a href="http://blog.csdn.net/defeattroy" title="木马屠城">Defeattroy</a></li>
<li><a href="http://www.smilgel.com/" title="听雨轩">MrSaxon</a></li>
<li><a href="http://lanbolee.com/blog/" title="博之博">Rambolee</a></li>
<li><a href="http://www.haoziyanwo.com/" title="耗子燕窝">浩子</a></li>
<li><a href="http://blog.csdn.net/u012815727" title="CloudOS">CloudOS</a></li>
</ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 leiqzhang
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'leiqzhang';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>