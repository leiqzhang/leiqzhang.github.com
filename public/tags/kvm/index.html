<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>kvm | Technology &amp; Life</title>
  <meta name="author" content="leiqzhang">
  
  <meta name="description" content="Virtualization Related Technologies">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Technology &amp; Life"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Technology &amp; Life" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Technology &amp; Life</a></h1>
  <h2><a href="/">blog of leiqzhang</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title tag">kvm</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-05-20T12:40:31.000Z"><a href="/2013/05/2013-05-20-qemu-virtio-refactoring/">May 20 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/05/2013-05-20-qemu-virtio-refactoring/">QEMU Fetures: Virtio Refactoring</a></h1>
  

    </header>
    <div class="entry">
      
        <h3>Background</h3>
<p>在研究QEMU的virtio-scsi时，发现了如下问题: 1.5的qemu相比1.2多了几种virtio及scsi相关的设备</p>
<ol>
<li><p>qemu-1.2</p>
<blockquote>
<p><strong>CMD:</strong> qemu-kvm -device ? 2&gt;&amp;1 | grep &quot;virtio|scsi&quot;</p>
<p><strong>OUTPUT:</strong> </p>
<ul>
<li>name &quot;scsi-hd&quot;, bus SCSI, desc &quot;virtual SCSI disk&quot;</li>
<li>name &quot;virtio-blk-pci&quot;, bus PCI, alias &quot;virtio-blk&quot;</li>
<li>name &quot;virtio-9p-pci&quot;, bus PCI</li>
<li>name &quot;scsi-block&quot;, bus SCSI, desc &quot;SCSI block device passthrough&quot;</li>
<li>name &quot;scsi-generic&quot;, bus SCSI, desc &quot;pass through generic scsi device (/dev/sg*)&quot;</li>
<li>name &quot;scsi-disk&quot;, bus SCSI, desc &quot;virtual SCSI disk or CD-ROM (legacy)&quot;</li>
<li>name &quot;virtserialport&quot;, bus virtio-serial-bus</li>
<li>name &quot;scsi-cd&quot;, bus SCSI, desc &quot;virtual SCSI CD-ROM&quot;</li>
<li>name &quot;virtconsole&quot;, bus virtio-serial-bus</li>
<li>name &quot;virtio-serial-pci&quot;, bus PCI, alias &quot;virtio-serial&quot;</li>
<li>name &quot;am53c974&quot;, bus PCI, desc &quot;AMD Am53c974 PCscsi-PCI SCSI adapter&quot;</li>
<li>name &quot;virtio-net-pci&quot;, bus PCI, alias &quot;virtio-net&quot;</li>
<li>name &quot;virtio-balloon-pci&quot;, bus PCI, alias &quot;virtio-balloon&quot;</li>
<li>name &quot;virtio-scsi-pci&quot;, bus PCI</li>
</ul>
</blockquote>
</li>
<li><p>qemu-1.5</p>
<blockquote>
<p><strong>CMD:</strong> ./x86_64-softmmu/qemu-system-x86_64  -device ? 2&gt;&amp;1 | grep &quot;virtio|scsi&quot;</p>
<p><strong>OUTPUT:</strong> </p>
<ul>
<li>name &quot;scsi-hd&quot;, bus SCSI, desc &quot;virtual SCSI disk&quot;</li>
<li>name &quot;virtio-blk-pci&quot;, bus PCI, alias &quot;virtio-blk&quot;</li>
<li>name &quot;vhost-scsi-pci&quot;, bus PCI</li>
<li>name &quot;scsi-block&quot;, bus SCSI, desc &quot;SCSI block device passthrough&quot;</li>
<li>name &quot;virtio-serial-device&quot;, bus virtio-bus</li>
<li>name &quot;virtio-scsi-common&quot;, bus virtio-bus</li>
<li>name &quot;scsi-generic&quot;, bus SCSI, desc &quot;pass through generic scsi device (/dev/sg*)&quot;</li>
<li>name &quot;vhost-scsi&quot;, bus virtio-bus</li>
<li>name &quot;scsi-disk&quot;, bus SCSI, desc &quot;virtual SCSI disk or CD-ROM (legacy)&quot;</li>
<li>name &quot;virtserialport&quot;, bus virtio-serial-bus</li>
<li>name &quot;scsi-cd&quot;, bus SCSI, desc &quot;virtual SCSI CD-ROM&quot;</li>
<li>name &quot;virtio-net-device&quot;, bus virtio-bus</li>
<li>name &quot;virtconsole&quot;, bus virtio-serial-bus</li>
<li>name &quot;virtio-serial-pci&quot;, bus PCI, alias &quot;virtio-serial&quot;</li>
<li>name &quot;virtio-balloon-device&quot;, bus virtio-bus</li>
<li>name &quot;virtio-rng-pci&quot;, bus PCI</li>
<li>name &quot;pvscsi&quot;, bus PCI</li>
<li>name &quot;am53c974&quot;, bus PCI, desc &quot;AMD Am53c974 PCscsi-PCI SCSI adapter&quot;</li>
<li>name &quot;virtio-balloon-pci&quot;, bus PCI, alias &quot;virtio-balloon&quot;</li>
<li>name &quot;virtio-scsi-pci&quot;, bus PCI</li>
<li>name &quot;virtio-blk-device&quot;, bus virtio-bus</li>
<li>name &quot;virtio-scsi-device&quot;, bus virtio-bus</li>
<li>name &quot;virtio-net-pci&quot;, bus PCI, alias &quot;virtio-net&quot;</li>
</ul>
</blockquote>
</li>
</ol>
<h3>Questions</h3>
<ol>
<li>What is virtio-bus?</li>
<li>Which device can provide virtio-bus?</li>
<li>How to use virtio-scsi-device or virtio-blk-device?</li>
<li>What is virtio-scsi-common?</li>
</ol>
<h3>Root Cause: Virtio Refactoring</h3>
<ol>
<li>Ref: <a href="http://wiki.qemu.org/Features/virtio-refactoring">http://wiki.qemu.org/Features/virtio-refactoring</a></li>
<li><p>Details:</p>
<blockquote>
<p>Actually QEMU has a lot of virtio devices, which are not QOM compliant; they can be used with two different transports:</p>
<p>PCI: with eg: -device virtio-blk-pci.
S390: with eg: -device virtio-blk-s390.
The new implementation is as follows:</p>
<p>A new bus is introduced: virtio-bus which is an abstract bus.</p>
<p>For each transport a specific implementation of virtio-bus is created. (eg: virtio-pci-bus for virtio-pci).</p>
<p>Each virtio transport is built with a virtio-bus that the virtio devices connect to.
VirtIODevice becomes a device which is abstract and must be connected on a virtio-bus.</p>
<p>Each virtio device are created (eg: virtio-blk) extends VirtioDevice and then connects on a virtio-bus.</p>
<p>As we discussed, we must keep the backward compatibility. So the re-factored device must have the same properties and the same behavior. We should have only one way to create the device, so the transport/virtio-bus/virtio-device layout is only internal to QEMU for S390 and PCI device.</p>
</blockquote>
</li>
</ol>
<h3>Answers:</h3>
<ul>
<li><p><strong>Q:</strong> What is virtio-bus?</p>
<blockquote>
<p><strong>A:</strong> An abstract bus for virtio device</p>
</blockquote>
</li>
<li><p><strong>Q:</strong> Which device can provide virtio-bus?</p>
<blockquote>
<p><strong>A:</strong> Every virtio related bus, such as virtio-pci-bus, virtio-scsi-bus, etc.</p>
</blockquote>
</li>
<li><p><strong>Q:</strong> How to use virtio-scsi-device or virtio-blk-device?</p>
<blockquote>
<p><strong>A:</strong> Both of them are <strong>VirtIODevice</strong> mentioned above. There is no way to use them explicit</p>
</blockquote>
</li>
<li><p><strong>Q:</strong> What is virtio-scsi-common?</p>
<blockquote>
<p><strong>A:</strong> Maybe not so related to this subject. It is used for new device supporting the tcm_vhost</p>
<p><strong>Ref:</strong> <a href="http://lists.gnu.org/archive/html/qemu-devel/2013-01/msg05821.html">http://lists.gnu.org/archive/html/qemu-devel/2013-01/msg05821.html</a></p>
<p><strong>Summary:</strong></p>
<p>Ok, so here is my attempt at a vhost-scsi device.  I&#39;m creating an entirely separate device, with the common parts of virtio-scsi and vhost-scsi (actually little more than the initialization) grouped into a VirtIOSCSICommon type.  The device is used simply like &quot;-device vhost-scsi-pci,wwpn=WWPN&quot;, with all configuration done in configfs beforehand.</p>
</blockquote>
</li>
</ul>
<h3>The Change of Qtree</h3>
<ol>
<li><p>CMD</p>
<blockquote>
<p>qemu-kvm -enable-kvm -name win2003 -M pc-0.15 -m 1024 -boot c -drive file=/pkgs/imgs/win7.img,if=none,format=raw,cache=none,id=drive0 -monitor stdio -vga qxl -vnc 186.100.8.144:0 -nodefaults  -device virtio-scsi-pci,id=scsi -device scsi-hd,drive=drive0 -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 -device usb-tablet,id=input0</p>
</blockquote>
</li>
<li><p>Qtree of Qemu 1.2</p>
</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>    dev: virtio-scsi-pci, id <span class="string">"scsi"</span>
        ioeventfd = on
        <span class="keyword">...</span>
        bus: scsi.0
            type SCSI
                dev: scsi-hd, id <span class="string">""</span>
                    drive = drive0
</pre></td></tr></table></figure>
3. Qtree of Qemu 1.3

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre>	    dev: virtio-scsi-pci, id <span class="string">"scsi"</span>
         ioeventfd = on
         <span class="keyword">...</span>
         bus: scsi.0
           type virtio-pci-bus
           dev: virtio-scsi-device, id <span class="string">""</span>
             num_queues = <span class="number">1</span>
             max_sectors = <span class="number">65535</span>
             cmd_per_lun = <span class="number">128</span>
             bus: scsi.0
               type SCSI
               dev: scsi-hd, id <span class="string">""</span>
                 drive = drive0
</pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-05-06T08:56:31.000Z"><a href="/2013/05/2013-05-06-qemu-contribute-submit-patch-steps/">May 6 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/05/2013-05-06-qemu-contribute-submit-patch-steps/">QEMU Contribute: steps of submit a patch</a></h1>
  

    </header>
    <div class="entry">
      
        <ol>
<li><p>邮件的收件人和抄送人</p>
<ul>
<li>收件人：qemu-devel@nongnu.org</li>
<li>抄送人<ul>
<li>参考代码库中的MAINTAINERS文件</li>
<li>使用scripts/getmaintainer.pl来获取此文件的主要提交者</li>
</ul>
</li>
</ul>
</li>
<li><p>邮件的主题和内容的格式</p>
<ul>
<li>使用git format-patch来生成标准格式的patch</li>
<li>需要带-s参数使得生成的PATCH中包含signed-off-by开头的行</li>
<li>邮件主题使用此命令生成的Patch文件中的subject</li>
<li>邮件正文使用此文盲生成的Patch文件中的body</li>
<li>包含大量更改的Patch，需按代码逻辑拆分为多个patch，组成patch series<ul>
<li>Patch series要求<ul>
<li>每部分的change均需保证可编译通过</li>
<li>文档类的change靠前</li>
</ul>
</li>
<li>邮件要求<ul>
<li>最开始是一个cover leter，必须包含PATCH的goal和diffstat，尽量使得cover letter的内容有意义<ul>
<li>每部分change单独放到一封邮件中，并回复cover letter，标题为[PATCH v1 0/5]等形式</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Patch要求</p>
<ul>
<li>符合QEMU的代码规范</li>
<li>注释明确，使用英文，没有拼写错误</li>
<li>需要基于当前git master生成Patch</li>
<li>不要包含无关内容</li>
</ul>
</li>
<li><p>邮件发出后</p>
<ul>
<li>跟进社区的回复，并持续跟进</li>
<li>如果是在社区review后再次发送的Patch，需在标题后加上v2、v3等后缀，依次类推</li>
<li>当社区中有协助进行review的，在后续版本的PATCH中恰当使用&quot;Reviewed-by&quot; tag，使得reviewer方便区分review内容</li>
<li>如果发现PATCH发出后没有回应，每隔一到两周，“全部回复”之前的Patch邮件，并在主题中带上”Ping“</li>
</ul>
</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-04-19T07:00:31.000Z"><a href="/2013/04/2013-04-19-qemu-block-features-live-blockcopy/">Apr 19 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/04/2013-04-19-qemu-block-features-live-blockcopy/">QEMU Block Fetures: live snapshot blockcopy</a></h1>
  

    </header>
    <div class="entry">
      
        <h3>Live Block Copy</h3>
<ol>
<li>Ref: <a href="http://wiki.qemu.org/Features/SnapshotsMultipleDevices#Application_to_live_block_copy">QEMU-Feature-SnapshotsMultipleDevices-LiveBlockCopy</a></li>
<li>Ref: <a href="https://bugzilla.redhat.com/show_bug.cgi?id=888426">more blockcopy usages</a></li>
<li>Process: snapshot; block-stream; drive-mirror; pivot (optional)</li>
<li><p>Libvirt Supprot</p>
<ol>
<li>start a vm  <figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>    	virsh <span class="operator"><span class="keyword">create</span> /root/vm/livecd/livecd.xml 
    	<span class="keyword">Domain</span> livecd created <span class="keyword">from</span> /root/vm/livecd/livecd.xml
        
</pre></td></tr></table></figure>


</li>
</ol>
</li>
</ol>
<pre><code><figure class="highlight"><pre>2. start drive mirroring 
    <span class="tag">&lt;<span class="title">notextile</span>&gt;</span>1<span class="tag">&lt;/<span class="title">notextile</span>&gt;</span>

3. stop drive mirroring
</pre></figure></code></pre>
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>    virsh blockjob --abort livecd /root/vm/livecd/data.img
</pre></td></tr></table></figure>
    4. have to add reuse flag if the target already exists
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>    virsh blockcopy livecd /root/vm/livecd/data.img /root/a.img --wait
    error: unsupported configuration: external destination file <span class="keyword">for</span> disk vda already exists and is not a block device: /root/a.img
</pre></td></tr></table></figure>
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>    virsh blockcopy livecd /root/vm/livecd/data.img /root/a.img --wait --reuse-external
    Now <span class="keyword">in</span> mirroring phase
</pre></td></tr></table></figure>
    5. just copy, don&#39;t go to mirroring phase
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>    virsh blockcopy livecd /root/vm/livecd/data.img /root/vm/livecd/a.img --wait --finish
    Successfully copied
</pre></td></tr></table></figure>
    6. can not run an in flight blockcopy if drive is in mirroring phase
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>    virsh blockcopy livecd /root/vm/livecd/data.img /root/vm/livecd/a.img --wait --async --reuse-external
    Now <span class="keyword">in</span> mirroring phase
</pre></td></tr></table></figure>
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>    virsh blockcopy livecd /root/vm/livecd/data.img /root/vm/livecd/b.img --finish --wait
    error: block copy still active: disk <span class="string">'vda'</span> already <span class="keyword">in</span> active block copy job
</pre></td></tr></table></figure>
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>    virsh blockcopy livecd /root/vm/livecd/data.img /root/vm/livecd/b.img --finish --wait --async
    error: block copy still active: disk <span class="string">'vda'</span> already <span class="keyword">in</span> active block copy job
</pre></td></tr></table></figure>
    7. can not migrate if drive is in blockcopy
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>    virsh migrate --live --verbose livecd qemu+ssh://186.100.8.136/system
    error: Requested operation is not valid: domain has an active block job
</pre></td></tr></table></figure>
    8. switch to the dest when blockcopy complete
<figure class="highlight lang-bash"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>    virsh blockcopy livecd /pkgs/imgs/a.img /root/a2.img --pivot --wait
    Successfully copied
</pre></td></tr></table></figure>
<figure class="highlight lang-xml"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>    <span class="tag">&lt;<span class="title">disk</span> <span class="attribute">type</span>=<span class="value">'file'</span> <span class="attribute">device</span>=<span class="value">'disk'</span>&gt;</span>
        <span class="tag">&lt;<span class="title">driver</span> <span class="attribute">name</span>=<span class="value">'qemu'</span> <span class="attribute">type</span>=<span class="value">'raw'</span> <span class="attribute">cache</span>=<span class="value">'none'</span>/&gt;</span>
        <span class="tag">&lt;<span class="title">source</span> <span class="attribute">file</span>=<span class="value">'/root/a2.img'</span>/&gt;</span>
        <span class="tag">&lt;<span class="title">target</span> <span class="attribute">dev</span>=<span class="value">'vda'</span> <span class="attribute">bus</span>=<span class="value">'virtio'</span>/&gt;</span>
        <span class="tag">&lt;<span class="title">alias</span> <span class="attribute">name</span>=<span class="value">'virtio-disk0'</span>/&gt;</span>
        <span class="tag">&lt;<span class="title">address</span> <span class="attribute">type</span>=<span class="value">'pci'</span> <span class="attribute">domain</span>=<span class="value">'0x0000'</span> <span class="attribute">bus</span>=<span class="value">'0x00'</span> <span class="attribute">slot</span>=<span class="value">'0x04'</span> <span class="attribute">function</span>=<span class="value">'0x0'</span>/&gt;</span>
    <span class="tag">&lt;/<span class="title">disk</span>&gt;</span>
</pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-04-19T03:30:31.000Z"><a href="/2013/04/2013-04-19-qemu-block-fetures-libvirt-blockcopy-pivot/">Apr 19 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/04/2013-04-19-qemu-block-fetures-libvirt-blockcopy-pivot/">QEMU Block Fetures: libvirt blockcopy switch to dest when complete</a></h1>
  

    </header>
    <div class="entry">
      
        <h3>libvirt blockcopy switch to dest when complete</h3>
<ol>
<li>create vm <pre><code>virsh create /pkgs/imgs/win2003.xml</code></pre></li>
<li>start blockcopy <pre><code>virsh blockcopy win2003 /pkgs/imgs/win2003.img /pkgs/imgs/t322.img --pivot --wait</code></pre></li>
<li>query blockcopy info <pre><code>virsh blockjob --info win2003 /pkgs/imgs/win2003.img</code></pre>
 <pre><code>Block Copy: [ 17 %]</code></pre></li>
<li>dumpxml after job complete <pre><code>virsh dumpxml win2003</code></pre>
 <pre><code>
                  <disk type='file' device='disk'>
                       <driver name='qemu' type='raw' cache='none'/>
                       <source file='/pkgs/imgs/t322.img'/>
                        <target dev='vda' bus='virtio'/>
                        <alias name='virtio-disk0'/>
                        <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>
                  </disk>
 </code></pre></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-04-18T05:00:31.000Z"><a href="/2013/04/2013-04-18-qemu-block-features-dataplane-perf/">Apr 18 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/04/2013-04-18-qemu-block-features-dataplane-perf/">QEMU Block Fetures: dataplane perf</a></h1>
  

    </header>
    <div class="entry">
      
        <h3>Dataplane vs Non-dataplane Perf</h3>
<ol>
<li>Envrionment<ol>
<li>Qemu 1.4 master branch</li>
<li>kernel: 3.5.0-2.fc17.x86_64</li>
<li>virtual disks location: the same local SATA harddisk with ext4 fs</li>
<li>VM start cmd (os: win7/qed, disk1: raw/non-dataplane/10G/NTFS, disk2: raw/dataplane/10G/NTFS) :</li>
</ol>
</li>
<li>Testing Tool And Testing Params:<ol>
<li>Only IOMeter App Running in VM, and no other IO in Host (Dom0)</li>
<li>Main Testing VM: 8 worker, 16K IO size, 0% Read,  100% Random,  and 50 outstanding IO </li>
<li>Pression VM: 8 worker, 16K IO size, 25% Read, 100% Random,  and 50 outstanding IO</li>
</ol>
</li>
<li><p>Testing Results:</p>
<p> |                            | IOPS | MBPS  |
 | ------                   | ------ | -----:   |
 | dataplanel          |  230.956328  |   3.608693  |
 |  non-dataplane  |  178.324867  |   2.786326  |</p>
</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-04-18T02:30:31.000Z"><a href="/2013/04/2013-04-17-qemu-block-features-block-streaming/">Apr 18 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/04/2013-04-17-qemu-block-features-block-streaming/">QEMU Block Fetures: live snapshot merge (block commit/block stream)</a></h1>
  

    </header>
    <div class="entry">
      
        <h3>Block Streaming</h3>
<ol>
<li>Ref: <a href="http://wiki.qemu.org/Features/Snapshots#Block_Streaming">QEMU-Feature-LiveSnapshotMerge-BlockStreaming</a></li>
<li>Process: Take data from parent image(s), and copy (stream) the data to the active layer.</li>
<li>QMP Steps<ol>
<li>Into Qemu and Prepare, <a href="#qmp_prepare">ref</a></li>
<li>[QMP_INPUT]<ul>
<li>Run Block Stream:<pre><code>
{ "execute": "block-stream",
   "arguments": 
   {"device":"drive0", "base": "win2003.qcow2", "speed": 20971520} 
}</code></pre></li>
</ul>
</li>
<li>CMD Args:<ul>
<li>device: block device to stream</li>
<li>base: base image, only sectors above this image are streamed. optional</li>
<li>speed: speed throttling, in MB/s, of the stream opt. optional</li>
</ul>
</li>
<li>[QMP_OUTPUT] After Job Completed, can see the QMP&#39;s output:<pre><code>{"timestamp": {"seconds": 1366281580, "microseconds": 788190}, "event": "BLOCK_JOB_COMPLETED", "data": {"device": "drive0", "len": 8589934592, "offset": 8589934592, "speed": 2097152, "type": "stream"}}</code></pre></li>
<li>Job Control / Job Query, <a href="#qmp_block_job_ctl">ref</a></li>
</ol>
</li>
<li>HMP Steps <ol>
<li>Into Qemu and Prepare, <a href="#hmp_prepare">ref</a></li>
<li>[HMP_INPUT]</li>
<li>Do the snapshot:<pre><code>snapshot_blkdev drive0 /pkgs/imgs/win.snap</code></pre></li>
<li>Run Block Stream:<pre><code>block_stream drive0 10 # 10 MB/s</code></pre></li>
<li>Job Control / Job Query, <a href="#hmp_block_job_ctl">ref</a></li>
<li>concurrency-opts</li>
<li>block_stream again when block_stream is not finished yet:<ul>
<li>[HMP_OUTPUT]: <pre><code>Device &#39;drive0&#39; is in use</code></pre></li>
</ul>
</li>
<li>another block_job, eg. block_commit when block_stream is not finished yet:<ul>
<li>[HMP_INPUT]: <pre><code>commit drive0</code></pre></li>
<li>[HMP_OUTPUT]: <pre><code>&#39;commit&#39; error for &#39;drive0&#39;: Device or resource busy</code></pre></li>
</ul>
</li>
</ol>
</li>
<li>Libvirt Supprot<ul>
<li>@see [TASK] IO mirror</li>
</ul>
</li>
</ol>
<h3><a id="qmp_prepare"></a>QMP Prepare</h3>
<ol>
<li>[CMD] qemu [...] -qmp tcp:localhost:4444,server<ul>
<li>Start QMP on a TCP socket, so that telnet can be used</li>
<li>-qmp conflicts with &quot;-monitor&quot;</li>
</ul>
</li>
<li>[CMD] telnet localhost 4444<ul>
<li>Run telnet</li>
<li>Should see the QMP&#39;s greeting banner:  <pre><code>
  {"QMP":{"version": {"qemu": {"micro": 50, "minor": 13, "major": 0}, "package": ""}, "capabilities": []}} </code></pre></li>
</ul>
</li>
<li>[QMP_INPUT] <ul>
<li>Make QMP enter command mode:  <pre><code>
  {"execute": "qmp_capabilities"}</code></pre></li>
</ul>
</li>
<li>[QMP_INPUT]<ul>
<li>Query the device info:  <pre><code>
  {"execute":"query-blockstats"} </code></pre>
  or
  <pre><code>
  { "execute": "human-monitor-command", "arguments": { "command-line": "info block" } } </code></pre></li>
<li>Get the device info from the output</li>
</ul>
</li>
</ol>
<h3><a id="hmp_prepare"></a> HMP Prepare</h3>
<ol>
<li>[CMD] qemu [...] -monitor stdio</li>
<li>[HMP_INPUT] Query the device info:<pre><code><figure class="highlight"><pre> <span class="tag">&lt;<span class="title">pre</span>&gt;</span><span class="tag">&lt;<span class="title">code</span>&gt;</span>info block<span class="tag">&lt;/<span class="title">code</span>&gt;</span><span class="tag">&lt;/<span class="title">pre</span>&gt;</span>
</pre></figure></code></pre>
</li>
</ol>
<h3><a id="qmp_block_job_ctl"></a> QMP Block Job Control</h3>
<ol>
<li>[QMP_INPUT] query block info <pre><code>{ "execute": "query-block-jobs", "arguments": {} }</code></pre></li>
<li>[QMP_INPUT] set block job speed <pre><code>{ "execute": "block-job-set-speed", "arguments": 
     {"device":drive0,"speed":2097152} 
 }</code></pre></li>
<li>[QMP_INPUT] cancel block job <pre><code>{ "execute": "block-job-cancel", "arguments": 
     {"device":drive0,"force":1} 
 }</code></pre></li>
<li>[QMP_INPUT] pause block job <pre><code>{ "execute": "block-job-pause", "arguments": 
     {"device":drive0} 
 }</code></pre></li>
<li>[QMP_INPUT] resume block job <pre><code>{ "execute": "block-job-resume", "arguments": 
     {"device":drive0} 
 }</code></pre></li>
<li>[QMP_INPUT] complete block job <pre><code>{ "execute": "block-job-complete", "arguments": 
     {"device":drive0} 
 }</code></pre>

</li>
</ol>
<h3><a id="hmp_block_job_ctl"></a> HMP Block Job Control</h3>
<ol>
<li>[HMP_INPUT] query block info <pre><code>info block-jobs</code></pre></li>
<li>[HMP_INPUT] set block job speed <pre><code>block_job_set_speed drive0 20</code></pre></li>
<li>[HMP_INPUT] cancel block job <pre><code>block_job_cancel drive0</code></pre></li>
<li>[HMP_INPUT] pause block job <pre><code>block_job_pause drive0</code></pre></li>
<li>[HMP_INPUT] resume block job <pre><code>block_job_resume drive0</code></pre></li>
<li>[HMP_INPUT] complete block job <pre><code>block_job_complete drive0</code></pre></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-04-17T03:40:31.000Z"><a href="/2013/04/2013-04-17-configure-qemu-kvm-env-in-f18/">Apr 17 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/04/2013-04-17-configure-qemu-kvm-env-in-f18/">新的F18环境下KVM环境搭建</a></h1>
  

    </header>
    <div class="entry">
      
        <h1>新的F18环境下KVM环境搭建</h1>
<ol>
<li><p>更改hostname，从localhost改为有意义的名字</p>
<blockquote>
<p>hostnamectl set-hostname DESIRED_HOST_NAME</p>
</blockquote>
</li>
<li><p>安装git: yum install git</p>
</li>
<li><p>clone KVM project</p>
<blockquote>
<p>git clone <a href="http://path/to/qemu.git">http://path/to/qemu.git</a></p>
</blockquote>
</li>
<li><p>编译</p>
<ol>
<li>./configure &#39;--enable-kvm&#39; &#39;--target-list=x86_64-softmmu&#39; &#39;--enable-virtio-blk-data-plane&#39; --disable-slirp</li>
<li>根据prefix的结果yum install缺失的包，几个主要的包：<ul>
<li>data-plane: libaio-devel</li>
</ul>
</li>
<li>根据configure的结果和已有环境的结果进行比对，对于未正常启用的安装相应的包<ul>
<li>SDL support： yum install SDL-devel</li>
<li>curses support：yum install ncurses-devel</li>
<li>curl support：yum install libcurl-devel</li>
<li>VNC<ul>
<li>VNC TLS support：gnutls-devel</li>
<li>VNC SASL support：cyrus-sasl-devel</li>
<li>VNC JPEG support：libjpeg-turbo-devel</li>
<li>VNC PNG support：libpng-devel</li>
<li>VNC WS support：gnutls-devel</li>
</ul>
</li>
<li>Documention: pod2man/makeinfo, yum install texinfo</li>
<li>fdt support:  libfdt-devel</li>
<li>uuid support: libuuid-devel</li>
<li>spice support: yum install spice-protocol spice-server spice-server-devel</li>
<li>seccomp support: libseccomp-devel</li>
</ul>
</li>
</ol>
</li>
<li><p>防火墙</p>
<ol>
<li>systemctl stop firewalld.service; </li>
<li>systemctl disable firewalld.service</li>
</ol>
</li>
<li><p>libvirt：</p>
<ol>
<li>virsh: libvirt-client</li>
<li>libvirtd: libvirt-daemon</li>
<li>libvirtd start related error</li>
<li>virsh list<ul>
<li>error: Failed to reconnect to the hypervisorerror: no valid connectionerror: Failed to connect socket to &#39;/var/run/libvirt/libvirt-sock&#39;: No such file or directory<ul>
<li>libvirtd -l ; 并观察错误输出，可找到所缺失的so文件，进而找到缺失的rpm包</li>
<li>yum install libvirt-daemon-driver-*</li>
</ul>
</li>
<li>error: libvirtd start error: Cannot read CA certificate &#39;/etc/pki/CA/cacert.pem&#39;: No such file or directory<ul>
<li>configuration:  /etc/libvirt/libvirtd.conf; uncomment the line: &quot;listen_tls=0&quot;</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-04-17T03:38:31.000Z"><a href="/2013/04/2013-04-17-qemu-block-features-image-format/">Apr 17 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/04/2013-04-17-qemu-block-features-image-format/">QEMU Block Features: Image Formats</a></h1>
  

    </header>
    <div class="entry">
      
        <h3>镜像格式</h3>
<ol>
<li><p>支持的格式</p>
<blockquote>
<p> Supported formats: vvfat <strong>vpc</strong> <strong>vmdk</strong> vdi sheepdog sheepdog sheepdog <strong>raw</strong> host_cdrom host_floppy host_device file <strong>qed</strong> <strong>qcow2</strong> qcow parallels nbd nbd nbd dmg tftp ftps ftp https http cow cloop bochs blkverify blkdebug </p>
</blockquote>
</li>
<li>镜像创建<ul>
<li>CMD: qemu-img</li>
<li>USAGE: qemu-img create [-q] [-f fmt] [-o options] filename [size]</li>
</ul>
</li>
<li>qemu启动虚拟机<ul>
<li>ARGS： -drive file=/path/to/img,if=none,format=<strong>FORMAT</strong>,cache=none,id=drive0</li>
</ul>
</li>
<li>libvirt配置</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre>		<span class="tag">&lt;<span class="title">disk</span> <span class="attribute">type</span>=<span class="value">"file"</span> <span class="attribute">device</span>=<span class="value">"disk"</span>&gt;</span>
		    <span class="tag">&lt;<span class="title">driver</span> <span class="attribute">name</span>=<span class="value">"qemu"</span> <span class="attribute">type</span>=<span class="value">"raw"</span>/&gt;</span> 
		    <span class="comment">&lt;!-- avaliable types when use the name "qemu": raw, bochs, qcow2 and qed --&gt;</span>
		    <span class="comment">&lt;!-- optional attributes: cache, io, ioeventfd, error_policy, event_idx, copy_on_read --&gt;</span>
		    <span class="comment">&lt;!-- cache attr: control the cache mechanism, possiable values are "default", "none", "writethrough", "writeback", "directsync" ( pass host page cache ) and "unsafe". --&gt;</span>
		    <span class="comment">&lt;!-- io attr: "thread" or "native" --&gt;</span>
		    <span class="comment">&lt;!-- ioeventfd attr: "on" or "off" --&gt;</span>
		    <span class="comment">&lt;!-- error_policy attr: "stop","report","ignore", and "enospace" --&gt;</span>
		    <span class="comment">&lt;!-- event_idx attr: "on" or "off", if "on", will reduce the number of interrupts and exits for the guest --&gt;</span>
		    <span class="comment">&lt;!-- copy_on_read attr: "on" or "off" --&gt;</span>
		    <span class="comment">&lt;!-- @see http://libvirt.org/formatdomain.html#elementsDevices --&gt;</span>
		    <span class="tag">&lt;<span class="title">source</span> <span class="attribute">file</span>=<span class="value">"/path/to/img"</span>/&gt;</span>
		    <span class="tag">&lt;<span class="title">target</span> <span class="attribute">dev</span>=<span class="value">"vda"</span> <span class="attribute">bus</span>=<span class="value">"virtio"</span>/&gt;</span>  
		    <span class="comment">&lt;!-- avaliable bus: ide, scsi, virtio, usb, sata, etc. if ommited, the bus type is inferred from the style of the device name (e.g. "sda" =&gt; "scsi"). --&gt;</span>
		<span class="tag">&lt;/<span class="title">disk</span>&gt;</span>
</pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-04-17T03:38:31.000Z"><a href="/2013/04/2013-04-17-qemu-block-features-atomic-snapshot/">Apr 17 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/04/2013-04-17-qemu-block-features-atomic-snapshot/">QEMU Block Fetures: Atomic Snapshot</a></h1>
  

    </header>
    <div class="entry">
      
        <h3>SnapshotsMultipleDevices</h3>
<ol>
<li><p>ref: <a href="http://wiki.qemu.org/Features/SnapshotsMultipleDevices#Atomic_Snapshots_of_Multiple_Devices">QEMU-Feature-SnapshotsMultipleDevices</a></p>
</li>
<li><p>QMP Steps</p>
<ul>
<li>[CMD] qemu [...] -qmp tcp:localhost:4444,server<ul>
<li>Start QMP on a TCP socket, so that telnet can be used</li>
<li>-qmp conflicts with &quot;-monitor&quot;</li>
</ul>
</li>
<li>[CMD] telnet localhost 4444<ul>
<li>Run telnet</li>
<li>Should see the QMP&#39;s greeting banner:<pre><code>{"QMP":{"version": {"qemu": {"micro": 50, "minor": 13, "major": 0}, "package": ""}, "capabilities": []}} </code></pre></li>
</ul>
</li>
<li>[QMP_INPUT] <ul>
<li>Make QMP enter command mode:<pre><code>{"execute": "qmp_capabilities"}</code></pre></li>
</ul>
</li>
<li>[QMP_INPUT]<ul>
<li>Query the device info:<pre><code>{"execute":"query-blockstats"} </code></pre>
or
<pre><code>{ "execute": "human-monitor-command", "arguments": { "command-line": "info block" } } </code></pre></li>
<li>Get the device info from the output</li>
</ul>
</li>
<li>[QMP_input]<ul>
<li>Atomic snapshot:<pre><code>
{ "execute": "transaction",
   "arguments": { 
       "actions": [
       { 'type': 'blockdev-snapshot-sync', 'data' : { "device": "drive0",
           "snapshot-file": "/pkgs/imgs/win2003.snap",
           "format": "qcow2" } },
       { 'type': 'blockdev-snapshot-sync', 'data' : { "device": "drive1",
           "snapshot-file": "/pkgs/imgs/data.snap",
           "format": "qcow2" } } 
       ] 
   } 
}</code></pre></li>
<li>View Result, will find the current <strong>device/backing_file/backing_file_depth</strong> have already changed:<pre><code>{ "execute": "human-monitor-command", "arguments": { "command-line": "info block" } } </code></pre></li>
<li>CMD Args:</li>
<li>type: the operation to perform. The only supported value is &quot;<strong>blockdev-snapshot-sync</strong>&quot;.</li>
<li>data: a dict which contents depand on the value of &quot;type&quot;</li>
<li>if type == &quot;blockdev-snapshot-sync&quot;:<ul>
<li>device: device name to snapshot ( can get from the <strong>info</strong> block command )</li>
<li>snapshto-file: name of new image file</li>
<li>format: format of new image ( support &quot;qed&quot;, &quot;qcow2&quot;, default &quot;qcow2&quot; )</li>
<li>mode: whether and how QEMU should create the snapshot file ( NewImageMode, optional, default &quot;absolute-paths&quot; ) ( Can set to &quot;existing&quot;, which means <del>do the <strong>internal snapshot</strong></del> use the file as snap )</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Libvirt Support
 1 Code</p>
<ul>
<li>Interface <strong>virDomainSnapshotCreateXML</strong> has a input arg <strong>flags</strong>, and can be set with <strong>VIR_DOMAIN_SNAPSHOT_CREATE_ATOMIC</strong> </li>
<li>With <strong>VIR_DOMAIN_SNAPSHOT_CREATE_ATOMIC</strong> libvirt guarantees that this command will not alter any disks unless the entire set of changes can be done atomically, making failure recovery simpler (note that it is still possible to fail after disks have changed, but only in the much rarer cases of running out of memory or disk space).
2 Steps</li>
<li>Create domain<ul>
<li>[LIBVIRT-INPUT] <pre><code>virsh create win2003.xml</code></pre></li>
<li>disks info:<pre><code>
      <disk type='file' device='disk'>
      <driver name='qemu' type='raw' cache='none'/>
      <source file='/pkgs/imgs/win2003.img'/>
      <target dev='vda' bus='virtio'/>
      </disk>
       <disk type='file' device='disk'>
      <driver name='qemu' type='qcow2' cache='none'/>
      <source file='/pkgs/imgs/data.qcow2'/>
      <target dev='vdb' bus='virtio'/>
      </disk>
</code></pre></li>
</ul>
</li>
<li>Create Snapshot XML  <pre><code>
      <domainsnapshot>
        <description>Test Libvirt Snapshot-Create</description>
        <disks>
          <disk name='/pkgs/imgs/win2003.img'>
            <source file='/pkgs/imgs/w.snap'/>
          </disk>
          <disk name='/pkgs/imgs/data.qcow2'>
            <source file='/pkgs/imgs/d.snap'/>
          </disk>
        </disks>
      </domainsnapshot> 
  </code></pre></li>
<li>Create Atomic Snapshot<ul>
<li>[LIBVIRT-INPUT] <pre><code>virsh snapshot-create 3 --xmlfile ./snap.xml  --disk-only <strong>--atomic</strong></code></pre></li>
<li>[LIBVIRT-OUTPUT] <pre><code>Domain snapshot 1366295688 created from &#39;./snap.xml&#39;</code></pre></li>
<li>Reult Disk Info:<pre><code>
      <disk type='file' device='disk'>
        <driver name='qemu' type='qcow2' cache='none'/>
        <source file='/pkgs/imgs/w.snap'/>
        <target dev='vda' bus='virtio'/>
        <alias name='virtio-disk0'/>
        <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>
      </disk>
      <disk type='file' device='disk'>
        <driver name='qemu' type='qcow2' cache='none'/>
        <source file='/pkgs/imgs/d.snap'/>
        <target dev='vdb' bus='virtio'/>
        <alias name='virtio-disk1'/>
        <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>
      </disk>
</code></pre></li>
</ul>
</li>
</ul>
</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:leiqzhang.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/HTTP/">HTTP</a><small>2</small></li>
  
    <li><a href="/categories/JavaScriptCSS/">JavaScript/CSS</a><small>2</small></li>
  
    <li><a href="/categories/LinuxUnix/">Linux/Unix</a><small>3</small></li>
  
    <li><a href="/categories/MySQL/">MySQL</a><small>2</small></li>
  
    <li><a href="/categories/MySQL/PHP/">PHP</a><small>1</small></li>
  
    <li><a href="/categories/PHP/">PHP</a><small>2</small></li>
  
    <li><a href="/categories/QEMU/">QEMU</a><small>9</small></li>
  
    <li><a href="/categories/QEMU/Virtualization/">Virtualization</a><small>9</small></li>
  
    <li><a href="/categories/WordPress/">WordPress</a><small>2</small></li>
  
    <li><a href="/categories/vim/">vim</a><small>3</small></li>
  
    <li><a href="/categories/virtualization/">virtualization</a><small>1</small></li>
  
    <li><a href="/categories/virtualization/vmware/">vmware</a><small>1</small></li>
  
    <li><a href="/categories/未分类/">未分类</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/bfc/">bfc</a><small>1</small></li>
  
    <li><a href="/tags/cache-control/">cache-control</a><small>1</small></li>
  
    <li><a href="/tags/collapse/">collapse</a><small>1</small></li>
  
    <li><a href="/tags/css/">css</a><small>1</small></li>
  
    <li><a href="/tags/dataplane/">dataplane</a><small>1</small></li>
  
    <li><a href="/tags/ervernote/">ervernote</a><small>1</small></li>
  
    <li><a href="/tags/etag/">etag</a><small>1</small></li>
  
    <li><a href="/tags/expires/">expires</a><small>1</small></li>
  
    <li><a href="/tags/float/">float</a><small>1</small></li>
  
    <li><a href="/tags/greasemonkey/">greasemonkey</a><small>1</small></li>
  
    <li><a href="/tags/hasLayout/">hasLayout</a><small>1</small></li>
  
    <li><a href="/tags/http/">http</a><small>2</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>1</small></li>
  
    <li><a href="/tags/kvm/">kvm</a><small>9</small></li>
  
    <li><a href="/tags/last-modified/">last-modified</a><small>1</small></li>
  
    <li><a href="/tags/libvirt/">libvirt</a><small>8</small></li>
  
    <li><a href="/tags/lighthttpd/">lighthttpd</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>1</small></li>
  
    <li><a href="/tags/mac/">mac</a><small>1</small></li>
  
    <li><a href="/tags/margin/">margin</a><small>1</small></li>
  
    <li><a href="/tags/md5sum/">md5sum</a><small>1</small></li>
  
    <li><a href="/tags/mysql/">mysql</a><small>2</small></li>
  
    <li><a href="/tags/patch/">patch</a><small>1</small></li>
  
    <li><a href="/tags/pdo/">pdo</a><small>1</small></li>
  
    <li><a href="/tags/perf/">perf</a><small>1</small></li>
  
    <li><a href="/tags/permalink/">permalink</a><small>1</small></li>
  
    <li><a href="/tags/php/">php</a><small>2</small></li>
  
    <li><a href="/tags/position/">position</a><small>1</small></li>
  
    <li><a href="/tags/post/">post</a><small>1</small></li>
  
    <li><a href="/tags/proxy/">proxy</a><small>1</small></li>
  
    <li><a href="/tags/qemu/">qemu</a><small>9</small></li>
  
    <li><a href="/tags/rewrite/">rewrite</a><small>1</small></li>
  
    <li><a href="/tags/scsi/">scsi</a><small>1</small></li>
  
    <li><a href="/tags/site-memory/">site memory</a><small>1</small></li>
  
    <li><a href="/tags/soap/">soap</a><small>1</small></li>
  
    <li><a href="/tags/sql/">sql</a><small>1</small></li>
  
    <li><a href="/tags/svn/">svn</a><small>1</small></li>
  
    <li><a href="/tags/tip/">tip</a><small>1</small></li>
  
    <li><a href="/tags/tree_conflict/">tree_conflict</a><small>1</small></li>
  
    <li><a href="/tags/vim/">vim</a><small>3</small></li>
  
    <li><a href="/tags/virtio/">virtio</a><small>1</small></li>
  
    <li><a href="/tags/vmware/">vmware</a><small>1</small></li>
  
    <li><a href="/tags/vpn/">vpn</a><small>1</small></li>
  
    <li><a href="/tags/wget/">wget</a><small>1</small></li>
  
    <li><a href="/tags/wordpress/">wordpress</a><small>2</small></li>
  
  </ul>
</div>


  

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 leiqzhang
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'leiqzhang';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>