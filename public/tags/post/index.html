<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>post | Technology &amp; Life</title>
  <meta name="author" content="leiqzhang">
  
  <meta name="description" content="Virtualization Related Technologies">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Technology &amp; Life"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Technology &amp; Life" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Technology &amp; Life</a></h1>
  <h2><a href="/">blog of leiqzhang</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title tag">post</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-11-15T09:17:35.000Z"><a href="/2010/11/2010-11-15-php_input_post/">Nov 15 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/11/2010-11-15-php_input_post/">php://input和$_POST</a></h1>
  

    </header>
    <div class="entry">
      
        <p>一个soap_server的实现框架代码如下：</p>
<p>[php]
$wsdlFile = realpath(dirname(<strong>FILE</strong>).&#39;/../wsdl/service.wsdl&#39;);
$actor = new soapServer($wsdlFile); //初始化soapServer
$actor-&gt;setClass(&#39;ServiceInterface&#39;);//导入方法
$actor-&gt;handle(file_get_contents(&#39;php://input&#39;)); //注意：这里使用了php://input
[/php]</p>
<p><strong>一个soap调用的数据是通过POST的方式发送给服务器的，那么上面的处理中为什么要使用php://input,是否可以使用$_POST？
</strong></p>
<p>一个典型的soap调用框架代码如下：</p>
<p>[php]
$client = new SoapClient(SOAP_SERVICEURL,array(&#39;trace&#39;=&gt;true));
//使用trace选项，可以保证后面的<strong>getLastRequest、</strong>getLastResponse等方法可以读取到相应的请求/响应
$ret = $client-&gt;getServiceName(&#39;serviceStr&#39;);
echo htmlspecialchars($client-&gt;<strong>getLastRequestHeaders());
 echo &quot;<br/>&quot;;
 echo htmlspecialchars($client-&gt;</strong>getLastRequest());
 echo &quot;<br/>&quot;;
 var_dump($ret);
 echo &quot;<br/>&quot;;
 echo htmlspecialchars($client-&gt;<strong>getLastResponseHeaders());
 echo &quot;<br/>&quot;;
 echo htmlspecialchars($client-&gt;</strong>getLastResponse());
 echo &quot;<br/>&quot;;
[/php]</p>
<p>以下是运行这段client后的输出：</p>
<p>[code]
POST <strong><strong> HTTP/1.1 Host: [*</strong></strong>] Connection: Keep-Alive User-Agent: PHP-SOAP/5.2.10 Content-Type: text/xml;
charset=utf-8 SOAPAction: &quot;urn:<strong><em>*</em></strong>#getServiceName&quot; Content-Length: <em>*</em></p>
<p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; <SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
xmlns:ns1="urn:****" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"></p>
<p><SOAP-ENV:Body><ns1:getServiceName><servicename xsi:type="xsd:string">serviceStr</servicename></ns1:getServiceName></SOAP-ENV:Body>
</SOAP-ENV:Envelope></p>
<p>NULL</p>
<p>HTTP/1.1 200 OK Date: Mon, 15 Nov 2010 08:19:16 GMT Server: Apache/2.0.63 (Unix) PHP/5.2.10
X-Powered-By: PHP/5.2.10 Set-Cookie: <strong>*</strong>; path=/; domain=<em>*</em> Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0 Pragma: no-cache Content-Length: 521
Keep-Alive: timeout=15, max=100 Connection: Keep-Alive Content-Type: text/xml; charset=utf-8</p>
<p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; <SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
xmlns:ns1="urn:AmsInterfaceswsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"
xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><SOAP-ENV:Body></p>
<p><ns1:getServiceNameResponse><return xsi:nil="true"/></ns1:getServiceNameResponse></SOAP-ENV:Body></SOAP-ENV:Envelope>
[/code]</p>
<p>由请求header可以看到，soap虽然使用的post的方式传输请求串，但是传递的数据是一个xml，content-type也是“text/xml”，而对于php://input,<a href="http://php.net/manual/en/wrappers.php.php">官方文档</a>给的是这样的说明:</p>
<p>php://input allows you to read raw data from the request body. In case of POST requests, it preferrable to <a href="http://www.php.net/manual/en/reserved.variables.httprawpostdata.php">$HTTP_RAW_POST_DATA</a> as it does not depend on special php.ini directives. Moreover, for those cases where <a href="http://www.php.net/manual/en/reserved.variables.httprawpostdata.php">$HTTP_RAW_POST_DATA</a> is not populated by default, it is a potentially less memory intensive alternative to activating <a href="http://www.php.net/manual/en/ini.core.php#ini.always-populate-raw-post-data">always_populate_raw_post_data</a>. php://input is not available with <em>enctype=&quot;multipart/form-data&quot;</em>.</p>
<blockquote>
<p><strong>Note</strong>:  A stream opened with php://input can only be read once; the stream does not support seek operations. However, depending on the SAPI implementation, it may be possible to open another php://input stream and restart reading. This is only possible if the request body data has been saved. Typically, this is the case for POST requests, but not other request methods, such as PUT or PROPFIND. </p>
</blockquote>
<p>也就是说php://input可以用来读取http post的raw request data。对于一般的表单post，http头中设置的contentType是&#39;application/x-form-www-urlencoded&#39;(无文件上传)或&#39;multipart/form-data&#39;(一般用于文件上传),这两种情况下，post的数据会被设置到$_POST中（第一种情况下，php://input也会被设置，第二种情况下，php://input则不会被设置），而对于text/xml这种类型，post数据并不会被设置到$_POST中，具体的post、get和php://input的实验可参考这篇<a href="http://tuzwu.javaeye.com/blog/798978">博文</a>。</p>
<p>这里只摘抄其测试结论：</p>
<p>1，Coentent-Type仅在取值为application/x-www-data-urlencoded和multipart/form-data两种情况下，PHP才会将http请求数据包中相应的数据填入全局变量$_POST
2，PHP不能识别的Content-Type类型的时候，会将http请求包中相应的数据填入变量$HTTP_RAW_POST_DATA
3,  只有Coentent-Type不为multipart/form-data的时候，PHP不会将http请求数据包中的相应数据填入php://input，否则其它情况都会。填入的长度，由Coentent-Length指定。
4，只有Content-Type为application/x-www-data-urlencoded时，php://input数据才跟$_POST数据相一致。
5，php://input数据总是跟$HTTP_RAW_POST_DATA相同，但是php://input比$HTTP_RAW_POST_DATA更凑效，且不需要特殊设置php.ini
6，PHP会将PATH字段的query_path部分，填入全局变量$_GET。通常情况下，GET方法提交的http请求，body为空。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:leiqzhang.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/HTTP/">HTTP</a><small>2</small></li>
  
    <li><a href="/categories/JavaScriptCSS/">JavaScript/CSS</a><small>2</small></li>
  
    <li><a href="/categories/LinuxUnix/">Linux/Unix</a><small>3</small></li>
  
    <li><a href="/categories/MySQL/">MySQL</a><small>2</small></li>
  
    <li><a href="/categories/MySQL/PHP/">PHP</a><small>1</small></li>
  
    <li><a href="/categories/PHP/">PHP</a><small>2</small></li>
  
    <li><a href="/categories/QEMU/">QEMU</a><small>9</small></li>
  
    <li><a href="/categories/QEMU/Virtualization/">Virtualization</a><small>9</small></li>
  
    <li><a href="/categories/WordPress/">WordPress</a><small>2</small></li>
  
    <li><a href="/categories/vim/">vim</a><small>3</small></li>
  
    <li><a href="/categories/virtualization/">virtualization</a><small>1</small></li>
  
    <li><a href="/categories/virtualization/vmware/">vmware</a><small>1</small></li>
  
    <li><a href="/categories/未分类/">未分类</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/bfc/">bfc</a><small>1</small></li>
  
    <li><a href="/tags/cache-control/">cache-control</a><small>1</small></li>
  
    <li><a href="/tags/collapse/">collapse</a><small>1</small></li>
  
    <li><a href="/tags/css/">css</a><small>1</small></li>
  
    <li><a href="/tags/dataplane/">dataplane</a><small>1</small></li>
  
    <li><a href="/tags/ervernote/">ervernote</a><small>1</small></li>
  
    <li><a href="/tags/etag/">etag</a><small>1</small></li>
  
    <li><a href="/tags/expires/">expires</a><small>1</small></li>
  
    <li><a href="/tags/float/">float</a><small>1</small></li>
  
    <li><a href="/tags/greasemonkey/">greasemonkey</a><small>1</small></li>
  
    <li><a href="/tags/hasLayout/">hasLayout</a><small>1</small></li>
  
    <li><a href="/tags/http/">http</a><small>2</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>1</small></li>
  
    <li><a href="/tags/kvm/">kvm</a><small>9</small></li>
  
    <li><a href="/tags/last-modified/">last-modified</a><small>1</small></li>
  
    <li><a href="/tags/libvirt/">libvirt</a><small>8</small></li>
  
    <li><a href="/tags/lighthttpd/">lighthttpd</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>1</small></li>
  
    <li><a href="/tags/mac/">mac</a><small>1</small></li>
  
    <li><a href="/tags/margin/">margin</a><small>1</small></li>
  
    <li><a href="/tags/md5sum/">md5sum</a><small>1</small></li>
  
    <li><a href="/tags/mysql/">mysql</a><small>2</small></li>
  
    <li><a href="/tags/patch/">patch</a><small>1</small></li>
  
    <li><a href="/tags/pdo/">pdo</a><small>1</small></li>
  
    <li><a href="/tags/perf/">perf</a><small>1</small></li>
  
    <li><a href="/tags/permalink/">permalink</a><small>1</small></li>
  
    <li><a href="/tags/php/">php</a><small>2</small></li>
  
    <li><a href="/tags/position/">position</a><small>1</small></li>
  
    <li><a href="/tags/post/">post</a><small>1</small></li>
  
    <li><a href="/tags/proxy/">proxy</a><small>1</small></li>
  
    <li><a href="/tags/qemu/">qemu</a><small>9</small></li>
  
    <li><a href="/tags/rewrite/">rewrite</a><small>1</small></li>
  
    <li><a href="/tags/scsi/">scsi</a><small>1</small></li>
  
    <li><a href="/tags/site-memory/">site memory</a><small>1</small></li>
  
    <li><a href="/tags/soap/">soap</a><small>1</small></li>
  
    <li><a href="/tags/sql/">sql</a><small>1</small></li>
  
    <li><a href="/tags/svn/">svn</a><small>1</small></li>
  
    <li><a href="/tags/tip/">tip</a><small>1</small></li>
  
    <li><a href="/tags/tree_conflict/">tree_conflict</a><small>1</small></li>
  
    <li><a href="/tags/vim/">vim</a><small>3</small></li>
  
    <li><a href="/tags/virtio/">virtio</a><small>1</small></li>
  
    <li><a href="/tags/vmware/">vmware</a><small>1</small></li>
  
    <li><a href="/tags/vpn/">vpn</a><small>1</small></li>
  
    <li><a href="/tags/wget/">wget</a><small>1</small></li>
  
    <li><a href="/tags/wordpress/">wordpress</a><small>2</small></li>
  
  </ul>
</div>


  

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 leiqzhang
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'leiqzhang';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>