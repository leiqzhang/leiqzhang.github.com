<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 2 | Archives | Technology &amp; Life</title>
  <meta name="author" content="leiqzhang">
  
  <meta name="description" content="Virtualization Related Technologies">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Technology &amp; Life"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Technology &amp; Life" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Technology &amp; Life</a></h1>
  <h2><a href="/">blog of leiqzhang</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title">Archives</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-04-01T16:38:37.000Z"><a href="/2011/04/2011-04-02-install-mac-os-snow-leopard-on-vmware/">Apr 2 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/04/2011-04-02-install-mac-os-snow-leopard-on-vmware/">vmware上安装Mac OS Snow Leopard</a></h1>
  

    </header>
    <div class="entry">
      
        <p>今天在vmware上安装了Mac OS Snow Leopard，记录过程以作备忘和参考。</p>
<p><strong>安装环境：</strong></p>
<p>Windows 7 + VmWare 7.1.2</p>
<p><strong>安装过程：</strong></p>
<ol>
<li><p>下载Hazard修改的Snow Leopard系统镜像，种子地址：<a href="http://thepiratebay.org/torrent/5203531/Snow_Leopard_10.6.1-10.6.2_Intel_AMD_made_by_Hazard">http://thepiratebay.org/torrent/5203531/Snow_Leopard_10.6.1-10.6.2_Intel_AMD_made_by_Hazard</a></p>
</li>
<li><p>下载一个事先定制好的一个vmware虚拟磁盘（VMDK）和引导iso：dariwn_snow.iso，地址：<a href="http://download607.mediafire.com/6ce95acc9glg/dhbxnndmznw/Snowy_Vmware_files.tbz2">http://download607.mediafire.com/6ce95acc9glg/dhbxnndmznw/Snowy_Vmware_files.tbz2</a></p>
</li>
<li><p>通过vmware打开step 2中下载的vmdk虚拟机，编辑其参数，将dariwn_snow.iso挂载到cd中，并开启此虚拟机</p>
</li>
<li><p>出现boot menu后，通过vmware插入step 1中下载的系统镜像（连接），然后根据boot menu提示按c启动安装</p>
</li>
<li><p>安装完毕在提示需要重启的时候，通过vmware将dariwn_snow.iso重新加载到cd中，然后强制重启虚拟机</p>
</li>
<li><p>进入苹果系统</p>
</li>
<li><p>通过vmware连接cd room，将dariwn_snow.iso挂载到系统中，桌面会出现vmware tools图标，点击安装vmware tools</p>
</li>
</ol>
<p>8.安装后会提示重启，直接点击重启虚拟机不能重启，需要手动强制重启。重启进入后，会在系统桌面看到vmware share doc的文件夹，点击进入时会提示找不到此路径，这是因为vmware还未设置共享文件夹的原因。通过vmware添加共享文件夹后即可使用</p>
<ol>
<li>从<a href="http://downloads.sourceforge.net/project/vmsvga2/Display/VMsvga2_v1.2.2_Common_Installer.pkg?use_mirror=garr下载Mac显示驱动，放在共享文件夹中，通过Mac安装，安装后重启，在系统设置中既可以选择更多的分辨率了">http://downloads.sourceforge.net/project/vmsvga2/Display/VMsvga2_v1.2.2_Common_Installer.pkg?use_mirror=garr下载Mac显示驱动，放在共享文件夹中，通过Mac安装，安装后重启，在系统设置中既可以选择更多的分辨率了</a></li>
</ol>
<p><strong>参考：</strong></p>
<p><a href="http://www.ihackintosh.com/2009/12/install-snow-leopard-in-vmware-7-windows-edition/">http://www.ihackintosh.com/2009/12/install-snow-leopard-in-vmware-7-windows-edition/</a></p>
<p><a href="http://www.sysprobs.com/increase-screen-resolution-wide-screen-support-mac-os-virtual-machine-vmware-player-workstation">http://www.sysprobs.com/increase-screen-resolution-wide-screen-support-mac-os-virtual-machine-vmware-player-workstation</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-02-28T07:30:40.000Z"><a href="/2011/02/2011-02-28-mysql-delete-rows-from-multi-tables/">Feb 28 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/02/2011-02-28-mysql-delete-rows-from-multi-tables/">MySQL同时删除多表数据</a></h1>
  

    </header>
    <div class="entry">
      
        <p>假设有如下三个表：</p>
<p>[sql]
CREATE TABLE <code>list</code> (
<code>id</code> int(11) NOT NULL AUTO_INCREMENT,
<code>name</code> varchar(255) DEFAULT NULL,
PRIMARY KEY (<code>id</code>)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8</p>
<p>CREATE TABLE <code>detail</code> (
<code>id</code> int(11) NOT NULL AUTO_INCREMENT,
<code>list_id</code> int(11) DEFAULT NULL,
PRIMARY KEY (<code>id</code>)
) ENGINE=InnoDB DEFAULT CHARSET=utf8</p>
<p>CREATE TABLE <code>workflow</code> (
<code>id</code> int(11) NOT NULL AUTO_INCREMENT,
<code>list_id</code> int(11) DEFAULT NULL,
PRIMARY KEY (<code>id</code>)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8</p>
<p>[/sql]</p>
<p>detail和workflow表均通过list_id和list表的id关联
如果我们需要删除list表中id为1及其关联的detail和workflow表记录时，除了通过添加外键关联ON DELETE约束外，可否在一条语句中完成?即可否使用类似于如下的语句：
[sql]
delete from list,detail,workflow where list.id=detail.list_id and workflow.list_id=list.id;
[/sql]</p>
<blockquote>
<p>答案是不行的，但是MySQL是可以支持多表删除的，具体用法如下(摘自MySQL<a href="http://dev.mysql.com/doc/refman/5.0/en/delete.html">官方文档</a>)</p>
</blockquote>
<p>对于第一种多表删除语法，只有在FROM语句之前列出的表中的匹配记录会被删除;第二种语法中,只有在FROM语句中列出的表(USING语句之前)中匹配的记录会被删除.效果是你可以同时从多个表中删除记录，而另外一些的表可仅起辅助查询作用.
For the first multiple-table syntax, only matching rows from the tables listed before the FROM clause are deleted. For the second multiple-table syntax, only matching rows from the tables listed in the FROM clause (before the USING clause) are deleted. The effect is that you can delete rows from many tables at the same time and have additional tables that are used only for searching:</p>
<p>DELETE t1, t2 FROM t1 INNER JOIN t2 INNER JOIN t3
WHERE t1.id=t2.id AND t2.id=t3.id;</p>
<p>Or:</p>
<p>DELETE FROM t1, t2 USING t1 INNER JOIN t2 INNER JOIN t3
WHERE t1.id=t2.id AND t2.id=t3.id;</p>
<p>这些语句使用了三个表来查找需要删除的记录，但是仅仅从t1和t2表中删除符合条件的记录
These statements use all three tables when searching for rows to delete, but delete matching rows only from tables t1 and t2.</p>
<p>前面的例子使用的是INNER JOIN，而多表删除时也可以使用其余类型的JOIN，如LEFT JOIN等等。例如，如果需要删除在t1中存在而在t2中不存在的数据，可以使用如下的删除语句:
The preceding examples use INNER JOIN, but multiple-table DELETE statements can use other types of join permitted in SELECT statements, such as LEFT JOIN. For example, to delete rows that exist in t1 that have no match in t2, use a LEFT JOIN:</p>
<p>DELETE t1 FROM t1 LEFT JOIN t2 ON t1.id=t2.id WHERE t2.id IS NULL;</p>
<p>如果多表删除涉及了存在外键约束的InnoDB表,MySQL优化器处理多表的顺序可能会和其父子关系不一致,这样的话,该语句会执行失败并进行回滚。这种情况下，可以通过添加ON DELETE外键约束来完成多表删除。
If you use a multiple-table DELETE statement involving InnoDB tables for which there are foreign key constraints, the MySQL optimizer might process tables in an order that differs from that of their parent/child relationship. In this case, the statement fails and rolls back. Instead, you should delete from a single table and rely on the ON DELETE capabilities that InnoDB provides to cause the other tables to be modified accordingly.</p>
<p>对于开头的三个表删除需求，可以这么进行删除:</p>
<p>[sql]
delete list,detail,workflow from list,detail,workflow where list.id=detail.list_id and workflow.list_id=list.id and list.id=1;</p>
<p>delete list,detail,workflow from list inner join detail inner join workflow where list.id=detail.list_id and workflow.list_id=list.id and list.id=1;</p>
<p>delete from list,detail,workflow using list inner join workflow inner join detail where list.id=detail.list_id and workflow.list_id=list.id and list.id=1;</p>
<p>[/sql]</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-02-25T12:44:03.000Z"><a href="/2011/02/2011-02-25-php-ignore_user_abort/">Feb 25 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/02/2011-02-25-php-ignore_user_abort/">PHP的ignore_user_abort方法</a></h1>
  

    </header>
    <div class="entry">
      
        <p>按照PHP文档说明：</p>
<blockquote>
<p>在 PHP 内部，系统维护着连接状态，其状态有三种可能的情况：</p>
<ul>
<li>0 - NORMAL（正常）</li>
</ul>
<ul>
<li>1 - ABORTED（异常退出）</li>
</ul>
<ul>
<li>2 - TIMEOUT（超时）</li>
</ul>
</blockquote>
<p>当 PHP 脚本正常地运行 NORMAL 状态时，连接为有效。当远程客户端中断连接时，ABORTED  状态的标记将会被打开。远程客户端连接的中断通常是由用户点击 STOP 按钮导致的。当连接时间超过 PHP 的时限（请参阅 <a href="http://www.php.net/manual/en/function.set-time-limit.php"><strong>set_time_limit()</strong></a> 函数）时，TIMEOUT 状态的标记将被打开。</p>
<p>可以决定脚本是否需要在客户端中断连接时退出。有时候让脚本完整地运行会带来很多方便，即使没有远程浏览器接受脚本的输出。默认的情况是当远程客户端连接中断时脚本将会退出。该处理过程可由  php.ini 的 ignore_user_abort 或由 Apache .conf  设置中对应的“php_value ignore_user_abort”以及 <a href="http://www.php.net/manual/en/function.ignore-user-abort.php"><strong>ignore_user_abort()</strong></a> 函数来控制。如果没有告诉 PHP 忽略用户的中断，脚本将会被中断，除非通过  <a href="http://www.php.net/manual/en/function.register-shutdown-function.php"><strong>register_shutdown_function()</strong></a> 设置了关闭触发函数。通过该关闭触发函数，当远程用户点击  STOP 按钮后，脚本再次尝试输出数据时，PHP 将会检测到连接已被中断，并调用关闭触发函数。</p>
<p>对于ignore_user_abort的理解误区主要是，认为应当用户在一个脚本加载期间点击了浏览器的“stop”按钮时：</p>
<ol>
<li>服务器端如果没有调用ignore_user_abort(true)，那么服务器端脚本的执行将会中断</li>
</ol>
<ol>
<li>如果调用了ignore_user_abort(true), 那么服务器端脚本将会继续执行</li>
</ol>
<ol>
<li>点击stop后，通过connection_status方法，就可以获取连接状态为ABORTED</li>
</ol>
<p>而实际上，只有php执行了输出操作，要将字符串输出到浏览器时才会去检测连接状态，也只有这时候才可以知道用户是否点击了&quot;stop&quot;按钮。当然，这是指后台脚本真正将字符串输出到浏览器时，如果中间存在缓存，则必须在缓存内容真正flush到浏览器时才可以知道连接状态（这里也需要注意一些杀毒软件会首先对网页输出进行缓存）。</p>
<p>实际上，ignore_user_abort的作用是：</p>
<ol>
<li>当脚本执行前调用了ignore_user_abort(true)忽略用户中断后，当有输出操作需要将信息输出给浏览器时，脚本会检测到连接其实已经终止了，会将connection的status设置为ABORTED，但会继续执行后面的脚本，而不会异常退出</li>
</ol>
<ol>
<li>而当脚本没有设置忽略用户中断时，在第一次将信息输出到浏览器时，检测到连接中断，此时后台脚本就会直接异常退出，并不会继续执行下去</li>
</ol>
<p>也就是说，如果一个PHP脚本没有输出，那么不论是否用户中断，也无论是否设置了忽略中断(ignore_user_abort)，脚本均会执行下去直至结束（除非超过脚本最长执行时间或者脚本本身异常)；当PHP脚本有输出时，仅会在输出到达浏览器时可以检测到用户是否已经中断，并根据ignore_user_abort的设置来决定是直接结束还是继续进行。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-02-25T12:24:13.000Z"><a href="/2011/02/2011-02-25-lighthttpd-wordpress-permalink-postname/">Feb 25 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/02/2011-02-25-lighthttpd-wordpress-permalink-postname/">lighthttpd实现WordPress永久链接(Permalink)</a></h1>
  

    </header>
    <div class="entry">
      
        <p>WordPress的永久链接(permalink)可支持自定义的链接结构,如本博客的url格式为<a href="http://leivli.duapp.com/%postname%,其中postname表示文章的别名。">http://leivli.duapp.com/%postname%,其中postname表示文章的别名。</a></p>
<p>站点迁移到lighthttpd环境后，需要进行一些配置才可以支持:</p>
<p>[code]</p>
<p>$HTTP[&quot;host&quot;] =~ &quot;leivli.(.<em>)&quot; {
url.rewrite-once = (
 &quot;^/(wp-admin\/.</em>)/?$&quot; =&gt; &quot;/$1&quot;,
 &quot;^/([_0-9a-zA-Z-]+)/?$&quot; =&gt; &quot;/index.php?name=$1&quot;,
 )
}</p>
<p>[/code]</p>
<p>原理其实就是将/postname形式的url重新改为index.php?name=postname的形式，但需要特殊处理管理入口(/wp-admin)，否则会认为wp-admin也是一个postname</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-01-05T13:58:32.000Z"><a href="/2011/01/2011-01-05-md5sum-check-with-file/">Jan 5 2011</a></time>
      
      
  
    <h1 class="title"><a href="/2011/01/2011-01-05-md5sum-check-with-file/">md5sum的--check用法</a></h1>
  

    </header>
    <div class="entry">
      
        <p>项目开发过程中，有时会批量更新替换一系列其他人提供的文件，文件提供者会给出各文件的路径和md5，在将文件替换后，也需要对md5进行校验。此时可以使用md5sum的--check参数进行批量验证：</p>
<p>用法是</p>
<p>[code]</p>
<p>md5sum --check ~/data_md5</p>
<p>[/code]</p>
<p>其中data_md5文件的内容如下：</p>
<p>[code]</p>
<p>MD5值[空格][空格]文件1路径
MD5值[空格][空格]文件2路径
...</p>
<p>[/code]</p>
<p>需要注意的是，每一行中的MD5值和路径之间必须是两个空格，否则md5sum会报文件不存在之类的错误。</p>
<p>检测的输出结果的格式如下：</p>
<p>[code]</p>
<p>文件1路径： OK
文件2路径： FAILED</p>
<p>[/code]</p>
<p>其中OK表示验证通过（文件md5和文件中给定的md5一直），FAILED表示验证失败</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-06T09:37:57.000Z"><a href="/2010/12/2010-12-06-vim-tips-incresing-list-substitute-replace/">Dec 6 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/2010-12-06-vim-tips-incresing-list-substitute-replace/">VIM中通过substitute/replace快速生成一系列连续的IP地址</a></h1>
  

    </header>
    <div class="entry">
      
        <p>今天有这么一个操作，需要快速添加一个IP段，如220.181.50.206～220.181.50.254，我需要快速生成该段中一个所有IP地址的列表，以进行IP地址的导入。</p>
<p>在VIM中可以这样：</p>
<p>首先输入第一行:</p>
<p>[code]</p>
<p>220.181.50.206</p>
<p>[/code]</p>
<p>然后yy复制第一行，并48p复制出49行&quot;220.181.50.206&quot;, 然后执行以下命令即可</p>
<p>[code]</p>
<p>：%s/50.\zs(\d+)\ze$/\=eval(submatch(1)+line(&quot;.&quot;)-1)/g</p>
<p>[/code]</p>
<p>该命令是指对于所有匹配的部分（ip最后一个段），加上当前行号减一，这样就生成了一个从206到254的连续ip地址列表。</p>
<p>Just Enjoy It！</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-11-30T13:27:24.000Z"><a href="/2010/11/2010-11-30-http-proxy-request-uri/">Nov 30 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/11/2010-11-30-http-proxy-request-uri/">HTTP请求头中Request-URI的取值和代理服务器proxy的关系</a></h1>
  

    </header>
    <div class="entry">
      
        <p>一个合法的HTTP URL的格式如下：</p>
<p>[code]http_URL = &quot;http:&quot; &quot;//&quot; host [ &quot;:&quot; port ] [ abs_path [ &quot;?&quot; query ]][/code]</p>
<p>当访问一个网站时，http的请求头中会包含一个Request-URI字段，该字段可以有四种类型的取值：</p>
<p>[code]Request-URI    = &quot;*&quot; | absoluteURI | abs_path | authority[/code]</p>
<p>其中星号&quot;*&quot;表示客户端请求的是服务器本身，而并没有请求特定的资源；authority格式只用于http协议的CONNECT方法。这两种本文不进行讨论，下面主要看另外两种</p>
<p>当请求是发送给代理服务器时，必须使用absoluteURI(绝对URI)格式。代理服务器需要转发该请求或者直接从本地的cache给出响应。需要注意的，代理服务器可能会将该
请求转发给另一个代理服务器，也可能会按照absoluteURI直接发送给相应的服务器。如我们需要通过代理服务器访问被墙掉的Facebook时，可以看到请求头如下：</p>
<p><img src="http://leivli.duapp.com/wp-content/uploads/2010/11/13.png" alt=""></p>
<p>其它情况下，http请求头中的RequestURI将会使用一个资源相对地址abs_path,并加上一个Host头，供web服务器通过Host和RequestURI生成相应的URI，当我们输入的
url没有abs_path时，则传递的RequestURI中的abs_path将自动设置为&#39;/&#39;。如我们直接访问我们的百度时，请求头如下：</p>
<p><img src="http://leivli.duapp.com/wp-content/uploads/2010/11/21.png" alt=""></p>
<p>结论：</p>
<p>当通过代理服务器访问某个URL时，发送的RequestURI必须时一个绝对URI，否则将发送一个相对资源地址，即http_url中的abs_path段(及后面的query)</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-11-29T12:37:07.000Z"><a href="/2010/11/2010-11-29-diff_svn_tree_conflict/">Nov 29 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/11/2010-11-29-diff_svn_tree_conflict/">整体diff比较SVN的tree conflict文件</a></h1>
  

    </header>
    <div class="entry">
      
        <p>通过svn merge合并代码时经常会报树冲突(tree conflict)，而对于每个树冲突不能简单的忽略了事，需要和待merge版本相应的文件进行diff才可以。</p>
<p>目前我们组的并行项目很多，svn merge时，树冲突往往非常多，一个一个手动去diff是一个很繁琐的过程，下午大概写了一个shell方法对所有树冲突的文件进行diff，可以将以下代码加入~/.bash_profile文件：</p>
<p>[shell]</p>
<h1>设定项目所在目录</h1>
<p>export PRJ=/home/work/var/www/htdocs</p>
<h1>根据svn info获取当前目录层次，并构造相应的diff目的文件路径</h1>
<h1>如当前在$PRJ/pro_merge/protected/modules/operations下</h1>
<h1>则&quot;getDir $PRJ/pro&quot;的结果是$PRJ/pro/protected/modules/operations</h1>
<h1>当然前提是svn info中的URL行对应的格式是<a href="https://*/*_BRANCH/protected/modules/operations或https://*/*_PD_BL/protected/modules/operations">https://*/*_BRANCH/protected/modules/operations或https://*/*_PD_BL/protected/modules/operations</a></h1>
<h1>可根据实际情况进行修改</h1>
<p>function getDir() { DIR=<code>echo $1 | sed &#39;s/\//\\\\\//g&#39;</code>; svn info | grep &quot;^URL&quot; | awk &#39;{print $2}&#39; | sed &quot;s/^https:.*(_BRANCH|_PD_BL)/$DIR/g&quot;; }</p>
<h1>通过svn st和awk获取所有树冲突文件相对路径</h1>
<h1>依次和指定的目标文件进行diff,其中忽略了对.png .gif等类型文件的处理</h1>
<p>function td() { svn st | grep &quot;^[[:space:]]+C&quot; | awk &#39;$2!~/(.<em>.png)|(.</em>.gif)/ {print $2}&#39; | xargs -t -i diff -u --exclude=&quot;.svn&quot; {} &quot;<code>getDir $1</code>/{}&quot;; }
[/shell]</p>
<p>假设合并代码后的目录是$PRJ/pro_merge,而合入的版本代码在$PRJ/pro_src,则可以在$PRJ/pro_merge的任意子目录下执行如下命令：</p>
<p>[shell]
td $PRJ/pro_src
[/shell]</p>
<p>即可输出当前目录下所有子目录的树冲突文件和带合并文件的diff情况</p>
<p>+++++++2010年12月6日更新++++++++++</p>
<p>该方法可以进一步扩展，将diff出来的没有不同的文件直接”svn resolved“了，因此写了一个简单的shell脚本：</p>
<p>[bash]</p>
<h1>! /bin/sh</h1>
<p>function getDir() { DIR=<code>echo $1 | sed &#39;s/\//\\\\\//g&#39;</code>; svn info | grep &quot;^URL&quot; | awk &#39;{print $2}&#39; | sed &quot;s/^https:.*(_BRANC
H|_PD_BL)/$DIR/g&quot;; }</p>
<p>files=<code>svn st | grep &quot;^[[:space:]]\+C&quot; | awk &#39;$2!~/(.*\.png)|(.*\.gif)/ {print $2}&#39;</code>
dir=<code>getDir $1</code>
for file in $files
do
    echo &quot;$file&quot;
    out=<code>diff -ur --exclude=&quot;\.svn&quot; &quot;$file&quot; &quot;$dir/$file&quot; 2&gt;&amp;1</code>
    if [ $? -eq &quot;0&quot; ]
    then
        echo will svn resolved $file
        svn resolved $file
    else
        echo &quot;$out&quot;
    fi
done</p>
<p>[/bash]</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-11-23T17:57:46.000Z"><a href="/2010/11/2010-11-24-http-cache/">Nov 24 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/11/2010-11-24-http-cache/">HTTP Cache相关</a></h1>
  

    </header>
    <div class="entry">
      
        <h2>Advanced Note：</h2>
<h3>Expiration</h3>
<p>Expires header</p>
<p>Cache-Control header</p>
<h3>Validation</h3>
<p>Last-Modified header</p>
<p>ETag header</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-11-22T16:35:16.000Z"><a href="/2010/11/2010-11-23-css-block-formatting-context/">Nov 23 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/11/2010-11-23-css-block-formatting-context/">CSS的block formatting context</a></h1>
  

    </header>
    <div class="entry">
      
        <p><strong>什么是块格式化内容：Block Formatting Context （BFC）</strong>
网页布局的时候，BFC会在常规流(与之并列的是浮动和绝对定位)中进行布局。BFC提供了一个环境，使得html元素在该环境内按照一定规则进行布局，而不会影响其它环境中的布局</p>
<p><strong>什么情况下生成BFC</strong></p>
<p>当一个元素满足以下条件时，它的包含块将会形成一个BFC：</p>
<ul>
<li>浮动(float属性非none)</li>
</ul>
<ul>
<li>overflow属性的计算值不是visible</li>
</ul>
<ul>
<li>display属性是table-cell、table-caption或着inline-block</li>
</ul>
<ul>
<li>绝对定位(position非static且非relative)</li>
</ul>
<p>需要注意的是，disaply属性为table时并不会建立一个BFC。但是由于display为table时，元素将会生成一个匿名框，这些框会具有display:table-cell属性，故会建立新的BFC。也就是说，建立BFC的是这个display为table-cell的匿名框而非table。所以在display:table和display:table-cell的元素上使用clear属性的效果是不一样的（见最后一小节示例）。
<strong>BFC的影响</strong></p>
<ol>
<li>rule 1. 在bfc内部，垂直相邻的框的margin将会折叠(collapse)</li>
</ol>
<ol>
<li>rule 2. 在同一个bfc内部，所有框的左外边均挨着包含块(bfc)的左侧(rtl时,是右外边挨着包含块的右侧)。即使该bfc中包含float元素也是如此，除非该bfc内部另外一个元素形成了一个新的bfc，这种情况下，该元素的框将会挨着float元素排列，宽度可能会由于float元素的存在而变窄</li>
</ol>
<ol>
<li>rule 3. 一个BFC的border-box不能和与其在同一个BFC的float元素的margin-box相互重叠。这就意味着，浏览器会在BFC上生成不可见的margin来避免它和float元素的margin-box相互重叠。所以，在紧接着float元素的BFC上设置负的margin是没有作用的。而且BFC的margin还是可以和float元素重叠的，不能重叠的只是border-box。</li>
</ol>
<ol>
<li>rule 4.  clear只能清除处于同一个bfc的元素</li>
</ol>
<p><strong>Rule 1 BFC and margin collapse</strong>
从rule 1可知，垂直相邻的框的margin发生collapse的情况只会发生在这两个相邻框在同一个bfc的情形下，而如果两个垂直相邻的框分属于不同的bfc,则不会发生折叠。
如下例:</p>
<p>[html]</p>
<h3>margin collapse in the same BFC:</h3>

 <div style="background-color:skyBlue">
     <p style="margin-bottom:20px;border:1px solid red">
        this is text 1 with style: <br/> {margin-bottom:20px;border:1px solid red}
     </p>
 </div>
 <div style="background-color:skyBlue">
     <p style="margin-top:10px;border:1px solid black">
        this is text 2 with style: <br/> {margin-top:10px;border:1px solid black&quot;}
     </p>
 </div>

 <h3>margin not collapse in different BFCs</h3>
 <div style="background-color:skyBlue">
     <p style="margin-bottom:20px;border:1px solid red">
        this is text 3 with style: <br/> {margin-bottom:20px;border:1px solid red}
     </p>
 </div>
 <div style="background-color:skyBlue;overflow:hidden">
     <p style="margin-top:10px;border:1px solid black">
        this is text 4 with style: <br/> {margin-top:10px;border:1px solid black&quot;} <br/>
        <b>but the containing div has property: &quot;overflow:hidden&quot;, make this div establish a new BFC</b>
     </p>
 </div>
[/html]

效果如下图所示，前两个段落中间的margin发生了collapse，变为了较大的20px，而下面两个段落并未发生collapse，总共是30px
<img src="http://leivli.duapp.com/wp-content/uploads/2010/11/12-1024x286.png" alt="">

因此在需要避免margin collapse时，可以通过构建BFC来实现，这也是为什么浮动的元素和绝对定位的元素不会发生margin collapse的原因了

<strong>Rule 2 float in the BFC</strong>

如果一个无top/bottom border、无top/bottom padding且不形成bfc的div内部包含多个float元素，由于float元素是脱离文档流的，所以即使该div具有margin，也会由于margin相邻而会发生collapse，从而形成一个零高度的div。如果多个这样的div相邻，如果水平空间允许，那么这些div中的float元素将会排列在同一行上，这可能并非预期的效果。如本意要布局一个两行两列div的如下代码片段:

[html]
 <h3>float in zero height divs of the same BFC</h3>

 <div style="margin:20px">
      <div style="float:left;border:1px solid green;background-color:red">float div r1c1</div>
      <div style="float:left;border:1px solid green;background-color:blue">float div r1c2</div>
 </div>

 <div style="margin:20px">
      <div style="float:left;border:1px solid green;background-color:gray">float div r2c1</div>
      <div style="float:left;border:1px solid green;background-color:yellow">float div r2c2</div>
 </div>
[/html]

将生成下列效果的页面,四个浮动框会排列在一行上，而非预期的两行两列布局:

<img src="http://leivli.duapp.com/wp-content/uploads/2010/11/2.png" alt="">

由rule 2可知，在同一个BFC内部，所有框的左外边会挨着左侧排列，即使包含float元素也是如此。因此，如果将上例中的两个div各自均改为BFC，就会达到预期的目的。由于bfc内部两个float元素均会各自生成一个bfc，这两个bfc就会并排排列（如果bfc宽度足够的话，如果不够，由于都是float，第二个float会下移)。而这两个不同BFC又处于初始包含块的BFC中，将会按照常规流进行布局，即第二个BFC排在第一个BFC下面，形成2行2列的样式：


    <span style="text-decoration: line-through;">
    <h3>float in zero height divs of the same BFC</h3>

     <div style="margin:20px">
    <div style="float:left;border:1px solid green;background-color:red">float div r1c1</div>
    <div style="float:left;border:1px solid green;background-color:blue">float div r1c2</div>
     </div>

<pre><code><figure class="highlight"><pre> <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"margin:20px"</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;border:1px solid green;background-color:gray"</span>&gt;</span>float div r2c1<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;border:1px solid green;background-color:yellow"</span>&gt;</span>float div r2c2<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
[html]
<span class="tag">&lt;<span class="title">h3</span>&gt;</span>float in zero height divs of different BFCs<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"margin:20px;overflow:hidden"</span>&gt;</span>
      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;border:1px solid green;background-color:red"</span>&gt;</span>float div r1c1<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;border:1px solid green;background-color:blue"</span>&gt;</span>float div r1c2<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"margin:20px;overflow:hidden"</span>&gt;</span>
      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;border:1px solid green;background-color:gray"</span>&gt;</span>float div r2c1<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;border:1px solid green;background-color:yellow"</span>&gt;</span>float div r2c2<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

[/html]



实际布局效果如下图：

<span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"http://leivli.duapp.com/wp-content/uploads/2010/11/3.png"</span> <span class="attribute">title</span>=<span class="value">"float_in_bfc"</span> <span class="attribute">height</span>=<span class="value">"131"</span> <span class="attribute">width</span>=<span class="value">"519"</span> <span class="attribute">alt</span>=<span class="value">""</span> <span class="attribute">class</span>=<span class="value">"aligncenter size-full wp-image-92"</span>&gt;</span><span class="tag">&lt;/<span class="title">img</span>&gt;</span>

<span class="tag">&lt;<span class="title">strong</span>&gt;</span>Rule 3 BFC  adjoin float<span class="tag">&lt;/<span class="title">strong</span>&gt;</span>

一个普通的div元素(未生成新的BFC)是会被相邻的float元素覆盖的，而一个生成BFC的div元素的border-box是不会被相邻的float元素覆盖的，但是其margin可以被覆盖。如下面的代码：
 [html]

<span class="tag">&lt;<span class="title">h3</span>&gt;</span>float and normal div overlap<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:gray"</span>&gt;</span>float div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"background-color:yellow;border:1px solid red"</span>&gt;</span> normal div <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

 <span class="tag">&lt;<span class="title">h3</span>&gt;</span>float and bfc div no overlap<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>
 <span class="tag">&lt;<span class="title">p</span>&gt;</span>both divs have no margin<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:gray"</span>&gt;</span>float div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"background-color:yellow;border:1px solid red;overflow:hidden"</span>&gt;</span> bfc div <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

 <span class="tag">&lt;<span class="title">p</span>&gt;</span>bfc div has margin<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:gray"</span>&gt;</span>float div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"background-color:yellow;border:1px solid red;overflow:hidden;margin-left:10px"</span>&gt;</span> bfc div <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

 <span class="tag">&lt;<span class="title">p</span>&gt;</span>float div has margin<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:gray;margin-right:10px;margin-right:10px"</span>&gt;</span>float div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"background-color:yellow;border:1px solid red;overflow:hidden"</span>&gt;</span> bfc div <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

[/html]



生成的效果如下图：

<span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"http://leivli.duapp.com/wp-content/uploads/2010/11/4-1024x209.png"</span> <span class="attribute">title</span>=<span class="value">"float_adjoin_bfc"</span> <span class="attribute">height</span>=<span class="value">"209"</span> <span class="attribute">width</span>=<span class="value">"1024"</span> <span class="attribute">alt</span>=<span class="value">""</span> <span class="attribute">class</span>=<span class="value">"aligncenter size-large wp-image-93"</span>&gt;</span><span class="tag">&lt;/<span class="title">img</span>&gt;</span>如图所示，前两个div中，float的div会和另一个div发生重叠，而后面三个示例可以看出，float框不会和相邻的bfc的border box发生重叠。正如rule 3所述，float和bfc的border box不会发生重叠：
当float和bfc都没有margin时，两者紧邻；当bfc有left margin时，该left margin可以被float框覆盖，两者还是紧邻；当float框有right margin时，bfc并不能将其覆盖。

再看另外一个例子，不多说，贴代码:
 [html]

<span class="tag">&lt;<span class="title">h3</span>&gt;</span>float and bfc div no overlap: another example<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>

 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"overflow:hidden"</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:red;width:200px"</span>&gt;</span>first: left float div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:right;background-color:green;width:200px"</span>&gt;</span>second: right float div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"overflow:hidden;background-color:yellow"</span>&gt;</span>third: bfc div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"overflow:hidden"</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:red;margin-right:20px;width:200px"</span>&gt;</span>first: left float div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:right;background-color:green;margin-left:20px;width:200px"</span>&gt;</span>second: right float div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"overflow:hidden;background-color:yellow"</span>&gt;</span>third: bfc div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"overflow:hidden"</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:red;width:200px"</span>&gt;</span>first: left float div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"float:right;background-color:green;width:200px"</span>&gt;</span>second: right float div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"overflow:hidden;background-color:yellow;margin:0 220px"</span>&gt;</span>third: bfc div<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

[/html]



实际运行效果图：

<span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"http://leivli.duapp.com/wp-content/uploads/2010/11/5-1024x95.png"</span> <span class="attribute">title</span>=<span class="value">"float_adjoin_bfc_another"</span> <span class="attribute">height</span>=<span class="value">"95"</span> <span class="attribute">width</span>=<span class="value">"1024"</span> <span class="attribute">alt</span>=<span class="value">""</span> <span class="attribute">class</span>=<span class="value">"aligncenter size-large wp-image-94"</span>&gt;</span><span class="tag">&lt;/<span class="title">img</span>&gt;</span>

该例子中有三组，各组均有三个div，分别为float left（width:200px）、float right（width:200px）和无float的third div（一个bfc），每组的包含div具有overflow:hidden，故会形成一个bfc，
即各组的三个div均处于一个独立的BFC中。

第一组中，根据Rule3， third div形成的bfc不会和float div发生重叠，因此在水平空间足够的情况下，三个div会排在一行，中间没有间隙。此时在third div上应用margin并不会在third div的两边和float div
交界处形成空隙。因为这种情况下，如果需要在中间框的左右两侧产生空隙，通过给该框添加margin是无法做到的，但是可以采用以下两个方法做到：

<span class="tag">&lt;<span class="title">ul</span>&gt;</span>

    <span class="tag">&lt;<span class="title">li</span>&gt;</span> 在两边的float上设置margin，如上图第二组所示<span class="tag">&lt;/<span class="title">li</span>&gt;</span>


    <span class="tag">&lt;<span class="title">li</span>&gt;</span> 给third div设置一个大于两边float框宽度的margin，如上图第三组所示<span class="tag">&lt;/<span class="title">li</span>&gt;</span>

<span class="tag">&lt;/<span class="title">ul</span>&gt;</span>


<span class="tag">&lt;<span class="title">strong</span>&gt;</span>Rule 4 BFC and clear<span class="tag">&lt;/<span class="title">strong</span>&gt;</span>
 clear只能清除处于同一个bfc的float元素，这里给出的例子说明了该点，同时也表示了第一段提到的在table元素和table-cell元素上使用clear的不同:
 [html]

<span class="tag">&lt;<span class="title">h3</span>&gt;</span>BFC &amp; clear -- clear on display:talbe vs clear on display:table-cell<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>

 <span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"clear:left"</span>&gt;</span>normal div after float div without clear<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"border:1px solid red"</span>&gt;</span>
<span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:gray;color:white;border:1px solid green"</span>&gt;</span>
line 1<span class="tag">&lt;<span class="title">br</span>/&gt;</span>
line 2
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"border:2px solid yellow"</span>&gt;</span>div content<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

 <span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"clear:left"</span>&gt;</span>normal div after float div with clear<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"border:1px solid red"</span>&gt;</span>
<span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:gray;color:white;border:1px solid green"</span>&gt;</span>
line 1<span class="tag">&lt;<span class="title">br</span>/&gt;</span>
line 2
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"border:2px solid yellow;clear:left"</span>&gt;</span>div content<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

 <span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"clear:left"</span>&gt;</span>display:table after float div without clear<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"border:1px solid red"</span>&gt;</span>
<span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:gray;color:white;border:1px solid green"</span>&gt;</span>
line 1<span class="tag">&lt;<span class="title">br</span>/&gt;</span>
line 2
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"display:table;border:2px solid yellow"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span>&gt;</span>div content<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

 <span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"clear:left"</span>&gt;</span>display:table after float div with clear<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"border:1px solid red"</span>&gt;</span>
<span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:gray;color:white;border:1px solid green"</span>&gt;</span>
line 1<span class="tag">&lt;<span class="title">br</span>/&gt;</span>
line 2
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"display:table;clear:left;border:2px solid yellow"</span>&gt;</span>div content<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

 <span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"clear:left"</span>&gt;</span>display:table-cell after float div without clear<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"border:1px solid red"</span>&gt;</span>
<span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:gray;color:white;border:1px solid green"</span>&gt;</span>
line 1<span class="tag">&lt;<span class="title">br</span>/&gt;</span>
line 2
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"display:table-cell;border:2px solid yellow"</span>&gt;</span>div content<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">div</span>&gt;</span>

<span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"clear:left"</span>&gt;</span>display:table-cell after float div with clear<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
 <span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"border:1px solid red"</span>&gt;</span>
<span class="tag">&lt;<span class="title">p</span> <span class="attribute">style</span>=<span class="value">"float:left;background-color:gray;color:white;border:1px solid green"</span>&gt;</span>
line 1<span class="tag">&lt;<span class="title">br</span>/&gt;</span>
line 2
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"display:table-cell;clear:left;border:2px solid yellow"</span>&gt;</span>div content<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
[/html]



实际运行效果图：
 <span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"http://leivli.duapp.com/wp-content/uploads/2010/11/6-1024x362.png"</span> <span class="attribute">title</span>=<span class="value">"bfc_and_clear"</span> <span class="attribute">height</span>=<span class="value">"362"</span> <span class="attribute">width</span>=<span class="value">"1024"</span> <span class="attribute">alt</span>=<span class="value">""</span> <span class="attribute">class</span>=<span class="value">"aligncenter size-large wp-image-96"</span>&gt;</span><span class="tag">&lt;/<span class="title">img</span>&gt;</span>第一组是一个float div后跟着一个普通的无设置clear属性的div（无display属性）的情况，此时float div会覆盖后面的div，从边框可以看到，后面的div还是从包含div的左侧开始的
 第二组和第一组一样，只是后面的div设置了clear:left属性，这就使得后面的div排列在了float div的下面
 第三组中后面的div设置了display:table,但是没有设置clear属性，与第一组相比，该div的表现更像是一个ＢＦＣ，因为该div没有从包含div的左侧开始，而是从float div的右侧开始布局。
 这就是文章刚开始提到的，display:table本身不会新建一个bfc，但是由于它会使得内部元素生成display:talbe-cell的匿名框，而该匿名框会建立一个bfc
 第四组可以看出第三组中的bfc并不是display:table创建的，因为设置了clear:left后，该div到了float div的下面。
 最后两组是display:table-cell的情况，此时后面的div会建立一个bfc，由于和float的div分属不同的div，clear属性是不起作用的，这也就是为什么第五组设置了clear属性后，表现和第四组一样的原因
</pre></figure></code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  

  <nav id="pagination">
  
    <a href="/archives/" class="alignleft prev">Prev</a>
  
  
    <a href="/archives/page/3/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:leiqzhang.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/HTTP/">HTTP</a><small>2</small></li>
  
    <li><a href="/categories/JavaScriptCSS/">JavaScript/CSS</a><small>2</small></li>
  
    <li><a href="/categories/LinuxUnix/">Linux/Unix</a><small>3</small></li>
  
    <li><a href="/categories/MySQL/">MySQL</a><small>2</small></li>
  
    <li><a href="/categories/MySQL/PHP/">PHP</a><small>1</small></li>
  
    <li><a href="/categories/PHP/">PHP</a><small>2</small></li>
  
    <li><a href="/categories/QEMU/">QEMU</a><small>9</small></li>
  
    <li><a href="/categories/QEMU/Virtualization/">Virtualization</a><small>9</small></li>
  
    <li><a href="/categories/WordPress/">WordPress</a><small>2</small></li>
  
    <li><a href="/categories/vim/">vim</a><small>3</small></li>
  
    <li><a href="/categories/virtualization/">virtualization</a><small>1</small></li>
  
    <li><a href="/categories/virtualization/vmware/">vmware</a><small>1</small></li>
  
    <li><a href="/categories/未分类/">未分类</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/bfc/">bfc</a><small>1</small></li>
  
    <li><a href="/tags/cache-control/">cache-control</a><small>1</small></li>
  
    <li><a href="/tags/collapse/">collapse</a><small>1</small></li>
  
    <li><a href="/tags/css/">css</a><small>1</small></li>
  
    <li><a href="/tags/dataplane/">dataplane</a><small>1</small></li>
  
    <li><a href="/tags/ervernote/">ervernote</a><small>1</small></li>
  
    <li><a href="/tags/etag/">etag</a><small>1</small></li>
  
    <li><a href="/tags/expires/">expires</a><small>1</small></li>
  
    <li><a href="/tags/float/">float</a><small>1</small></li>
  
    <li><a href="/tags/greasemonkey/">greasemonkey</a><small>1</small></li>
  
    <li><a href="/tags/hasLayout/">hasLayout</a><small>1</small></li>
  
    <li><a href="/tags/http/">http</a><small>2</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>1</small></li>
  
    <li><a href="/tags/kvm/">kvm</a><small>9</small></li>
  
    <li><a href="/tags/last-modified/">last-modified</a><small>1</small></li>
  
    <li><a href="/tags/libvirt/">libvirt</a><small>8</small></li>
  
    <li><a href="/tags/lighthttpd/">lighthttpd</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>1</small></li>
  
    <li><a href="/tags/mac/">mac</a><small>1</small></li>
  
    <li><a href="/tags/margin/">margin</a><small>1</small></li>
  
    <li><a href="/tags/md5sum/">md5sum</a><small>1</small></li>
  
    <li><a href="/tags/mysql/">mysql</a><small>2</small></li>
  
    <li><a href="/tags/patch/">patch</a><small>1</small></li>
  
    <li><a href="/tags/pdo/">pdo</a><small>1</small></li>
  
    <li><a href="/tags/perf/">perf</a><small>1</small></li>
  
    <li><a href="/tags/permalink/">permalink</a><small>1</small></li>
  
    <li><a href="/tags/php/">php</a><small>2</small></li>
  
    <li><a href="/tags/position/">position</a><small>1</small></li>
  
    <li><a href="/tags/post/">post</a><small>1</small></li>
  
    <li><a href="/tags/proxy/">proxy</a><small>1</small></li>
  
    <li><a href="/tags/qemu/">qemu</a><small>9</small></li>
  
    <li><a href="/tags/rewrite/">rewrite</a><small>1</small></li>
  
    <li><a href="/tags/scsi/">scsi</a><small>1</small></li>
  
    <li><a href="/tags/site-memory/">site memory</a><small>1</small></li>
  
    <li><a href="/tags/soap/">soap</a><small>1</small></li>
  
    <li><a href="/tags/sql/">sql</a><small>1</small></li>
  
    <li><a href="/tags/svn/">svn</a><small>1</small></li>
  
    <li><a href="/tags/tip/">tip</a><small>1</small></li>
  
    <li><a href="/tags/tree_conflict/">tree_conflict</a><small>1</small></li>
  
    <li><a href="/tags/vim/">vim</a><small>3</small></li>
  
    <li><a href="/tags/virtio/">virtio</a><small>1</small></li>
  
    <li><a href="/tags/vmware/">vmware</a><small>1</small></li>
  
    <li><a href="/tags/vpn/">vpn</a><small>1</small></li>
  
    <li><a href="/tags/wget/">wget</a><small>1</small></li>
  
    <li><a href="/tags/wordpress/">wordpress</a><small>2</small></li>
  
  </ul>
</div>


  

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 leiqzhang
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'leiqzhang';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>